(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["CoreAdminHome"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["CoreAdminHome"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/CoreAdminHome/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"ArchivingSettings",(function(){return E})),a.d(t,"BrandingSettings",(function(){return Y})),a.d(t,"SmtpSettings",(function(){return te})),a.d(t,"JsTrackingCodeGenerator",(function(){return ht})),a.d(t,"JsTrackingCodeGeneratorSitesWithoutData",(function(){return Nt})),a.d(t,"ImageTrackingCodeGenerator",(function(){return Pt})),a.d(t,"TrackingFailures",(function(){return ca})),"undefined"!==typeof window){var o=window.document.currentScript,n=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(a.p=n[1])}var i=a("8bbf");const r={class:"form-group row"},l={class:"col s12"},s={class:"col s12 m6"},c={class:"form-description",style:{"margin-left":"4px"}},d={for:"enableBrowserTriggerArchiving2"},m=["innerHTML"],u={class:"col s12 m6"},g=["innerHTML"],p={class:"form-group row"},b={class:"col s12"},h={class:"input-field col s12 m6"},j=["disabled"],O={class:"form-description"},C={class:"col s12 m6"},v={key:0,class:"form-help"},k={key:0},V=Object(i["createElementVNode"])("br",null,null,-1),N=Object(i["createElementVNode"])("br",null,null,-1),T=Object(i["createElementVNode"])("br",null,null,-1);function f(e,t,a,o,n,f){const S=Object(i["resolveComponent"])("SaveButton"),y=Object(i["resolveComponent"])("ContentBlock");return Object(i["openBlock"])(),Object(i["createBlock"])(y,{"content-title":e.translate("CoreAdminHome_ArchivingSettings"),anchor:"archivingSettings",class:"matomo-archiving-settings"},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",null,[Object(i["createElementVNode"])("div",r,[Object(i["createElementVNode"])("h3",l,Object(i["toDisplayString"])(e.translate("General_AllowPiwikArchivingToTriggerBrowser")),1),Object(i["createElementVNode"])("div",s,[Object(i["createElementVNode"])("p",null,[Object(i["createElementVNode"])("label",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{type:"radio",id:"enableBrowserTriggerArchiving1",name:"enableBrowserTriggerArchiving",value:"1","onUpdate:modelValue":t[0]||(t[0]=t=>e.enableBrowserTriggerArchivingValue=t)},null,512),[[i["vModelRadio"],e.enableBrowserTriggerArchivingValue]]),Object(i["createElementVNode"])("span",null,Object(i["toDisplayString"])(e.translate("General_Yes")),1),Object(i["createElementVNode"])("span",c,Object(i["toDisplayString"])(e.translate("General_Default")),1)])]),Object(i["createElementVNode"])("p",null,[Object(i["createElementVNode"])("label",d,[Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{type:"radio",id:"enableBrowserTriggerArchiving2",name:"enableBrowserTriggerArchiving",value:"0","onUpdate:modelValue":t[1]||(t[1]=t=>e.enableBrowserTriggerArchivingValue=t)},null,512),[[i["vModelRadio"],e.enableBrowserTriggerArchivingValue]]),Object(i["createElementVNode"])("span",null,Object(i["toDisplayString"])(e.translate("General_No")),1),Object(i["createElementVNode"])("span",{class:"form-description",innerHTML:e.$sanitize(e.archivingTriggerDesc),style:{"margin-left":"4px"}},null,8,m)])])]),Object(i["createElementVNode"])("div",u,[Object(i["createElementVNode"])("div",{class:"form-help",innerHTML:e.$sanitize(e.archivingInlineHelp)},null,8,g)])]),Object(i["createElementVNode"])("div",p,[Object(i["createElementVNode"])("h3",b,Object(i["toDisplayString"])(e.translate("General_ReportsContainingTodayWillBeProcessedAtMostEvery")),1),Object(i["createElementVNode"])("div",h,[Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.todayArchiveTimeToLiveValue=t),id:"todayArchiveTimeToLive",disabled:!e.isGeneralSettingsAdminEnabled},null,8,j),[[i["vModelText"],e.todayArchiveTimeToLiveValue]]),Object(i["createElementVNode"])("span",O,Object(i["toDisplayString"])(e.translate("General_RearchiveTimeIntervalOnlyForTodayReports")),1)]),Object(i["createElementVNode"])("div",C,[e.isGeneralSettingsAdminEnabled?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",v,[e.showWarningCron?(Object(i["openBlock"])(),Object(i["createElementBlock"])("strong",k,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("General_NewReportsWillBeProcessedByCron")),1),V,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_ReportsWillBeProcessedAtMostEveryHour"))+" "+Object(i["toDisplayString"])(e.translate("General_IfArchivingIsFastYouCanSetupCronRunMoreOften")),1),N])):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_SmallTrafficYouCanLeaveDefault",e.todayArchiveTimeToLiveDefault))+" ",1),T,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_MediumToHighTrafficItIsRecommendedTo",1800,3600)),1)])):Object(i["createCommentVNode"])("",!0)])]),Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(S,{saving:e.isLoading,onConfirm:t[3]||(t[3]=t=>e.save())},null,8,["saving"])])])]),_:1},8,["content-title"])}var S=a("19dc"),y=a("a5a2"),A=Object(i["defineComponent"])({props:{enableBrowserTriggerArchiving:Boolean,showSegmentArchiveTriggerInfo:Boolean,isGeneralSettingsAdminEnabled:Boolean,showWarningCron:Boolean,todayArchiveTimeToLive:Number,todayArchiveTimeToLiveDefault:Number},components:{ContentBlock:S["ContentBlock"],SaveButton:y["SaveButton"]},data(){return{isLoading:!1,enableBrowserTriggerArchivingValue:this.enableBrowserTriggerArchiving?1:0,todayArchiveTimeToLiveValue:this.todayArchiveTimeToLive}},watch:{enableBrowserTriggerArchiving(e){this.enableBrowserTriggerArchivingValue=e?1:0},todayArchiveTimeToLive(e){this.todayArchiveTimeToLiveValue=e}},computed:{archivingTriggerDesc(){let e="";return e+=Object(S["translate"])("General_ArchivingTriggerDescription",Object(S["externalLink"])("https://matomo.org/docs/setup-auto-archiving/"),"</a>"),this.showSegmentArchiveTriggerInfo&&(e+=Object(S["translate"])("General_ArchivingTriggerSegment")),e},archivingInlineHelp(){let e=Object(S["translate"])("General_ArchivingInlineHelp");return e+="<br/>",e+=Object(S["translate"])("General_SeeTheOfficialDocumentationForMoreInformation",Object(S["externalLink"])("https://matomo.org/docs/setup-auto-archiving/"),"</a>"),e}},methods:{save(){this.isLoading=!0,S["AjaxHelper"].post({module:"API",method:"CoreAdminHome.setArchiveSettings"},{enableBrowserTriggerArchiving:this.enableBrowserTriggerArchivingValue,todayArchiveTimeToLive:this.todayArchiveTimeToLiveValue}).then(()=>{this.isLoading=!1;const e=S["NotificationsStore"].show({message:Object(S["translate"])("CoreAdminHome_SettingsSaveSuccess"),type:"transient",id:"generalSettings",context:"success"});S["NotificationsStore"].scrollToNotification(e)}).finally(()=>{this.isLoading=!1})}}});A.render=f;var E=A;const w={id:"logoSettings"},_={id:"logoUploadForm",ref:"logoUploadForm",method:"post",enctype:"multipart/form-data",action:"index.php?module=CoreAdminHome&format=json&action=uploadCustomLogo"},H={key:0},D=["value"],x=Object(i["createElementVNode"])("input",{type:"hidden",name:"force_api_session",value:"1"},null,-1),L={key:0},B={key:0,class:"alert alert-warning uploaderror"},U={class:"row"},F={class:"col s12"},I=["src"],M={class:"row"},P={class:"col s12"},G=["src"],J={key:1},q=["innerHTML"],R={key:1},W={class:"alert alert-warning"};function K(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("SaveButton"),c=Object(i["resolveComponent"])("ContentBlock"),d=Object(i["resolveDirective"])("form");return Object(i["openBlock"])(),Object(i["createBlock"])(c,{"content-title":e.translate("CoreAdminHome_BrandingSettings"),anchor:"brandingSettings"},{default:Object(i["withCtx"])(()=>[Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("div",null,[Object(i["createElementVNode"])("p",null,Object(i["toDisplayString"])(e.translate("CoreAdminHome_CustomLogoHelpText")),1),Object(i["createVNode"])(l,{name:"useCustomLogo",uicontrol:"checkbox","model-value":e.enabled,"onUpdate:modelValue":t[0]||(t[0]=t=>e.onUseCustomLogoChange(t)),title:e.translate("CoreAdminHome_UseCustomLogo"),"inline-help":e.help},null,8,["model-value","title","inline-help"]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",w,[Object(i["createElementVNode"])("form",_,[e.fileUploadEnabled?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",H,[Object(i["createElementVNode"])("input",{type:"hidden",name:"token_auth",value:e.tokenAuth},null,8,D),x,e.logosWriteable?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",L,[Object(i["createVNode"])(i["Transition"],{name:"fade-out"},{default:Object(i["withCtx"])(()=>[e.showUploadError?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",B,Object(i["toDisplayString"])(e.translate("CoreAdminHome_LogoUploadFailed")),1)):Object(i["createCommentVNode"])("",!0)]),_:1}),Object(i["createVNode"])(l,{uicontrol:"file",name:"customLogo","model-value":e.customLogo,"onUpdate:modelValue":t[1]||(t[1]=t=>e.onCustomLogoChange(t)),title:e.translate("CoreAdminHome_LogoUpload"),"inline-help":e.translate("CoreAdminHome_LogoUploadHelp","JPG / PNG / GIF","110")},null,8,["model-value","title","inline-help"]),Object(i["createElementVNode"])("div",U,[Object(i["createElementVNode"])("div",F,[Object(i["createElementVNode"])("img",{src:e.pathUserLogoWithBuster,id:"currentLogo",style:{"max-height":"150px"},ref:"currentLogo"},null,8,I)])]),Object(i["createVNode"])(l,{uicontrol:"file",name:"customFavicon","model-value":e.customFavicon,"onUpdate:modelValue":t[2]||(t[2]=t=>e.onFaviconChange(t)),title:e.translate("CoreAdminHome_FaviconUpload"),"inline-help":e.translate("CoreAdminHome_LogoUploadHelp","JPG / PNG / GIF","16")},null,8,["model-value","title","inline-help"]),Object(i["createElementVNode"])("div",M,[Object(i["createElementVNode"])("div",P,[Object(i["createElementVNode"])("img",{src:e.pathUserFaviconWithBuster,id:"currentFavicon",width:"16",height:"16",ref:"currentFavicon"},null,8,G)])])])):Object(i["createCommentVNode"])("",!0),e.logosWriteable?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",J,[Object(i["createElementVNode"])("div",{class:"alert alert-warning",innerHTML:e.$sanitize(e.logosNotWriteableWarning)},null,8,q)]))])):Object(i["createCommentVNode"])("",!0),e.fileUploadEnabled?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",R,[Object(i["createElementVNode"])("div",W,Object(i["toDisplayString"])(e.translate("CoreAdminHome_FileUploadDisabled","file_uploads=1")),1)]))],512)],512),[[i["vShow"],e.enabled]]),Object(i["createVNode"])(s,{onConfirm:t[3]||(t[3]=t=>e.save()),saving:e.isLoading},null,8,["saving"])])),[[d]])]),_:1},8,["content-title"])}const{$:z}=window;var Q=Object(i["defineComponent"])({props:{fileUploadEnabled:{type:Boolean,required:!0},logosWriteable:{type:Boolean,required:!0},useCustomLogo:{type:Boolean,required:!0},pathUserLogoDirectory:{type:String,required:!0},pathUserLogo:{type:String,required:!0},pathUserLogoSmall:{type:String,required:!0},pathUserLogoSvg:{type:String,required:!0},hasUserLogo:{type:Boolean,required:!0},pathUserFavicon:{type:String,required:!0},hasUserFavicon:{type:Boolean,required:!0},isPluginsAdminEnabled:{type:Boolean,required:!0}},components:{Field:y["Field"],ContentBlock:S["ContentBlock"],SaveButton:y["SaveButton"]},directives:{Form:y["Form"]},data(){return{isLoading:!1,enabled:this.useCustomLogo,customLogo:this.pathUserLogo,customFavicon:this.pathUserFavicon,showUploadError:!1,currentLogoSrcExists:this.hasUserLogo,currentFaviconSrcExists:this.hasUserFavicon,currentLogoCacheBuster:(new Date).getTime(),currentFaviconCacheBuster:(new Date).getTime()}},computed:{tokenAuth(){return S["Matomo"].token_auth},logosNotWriteableWarning(){return Object(S["translate"])("CoreAdminHome_LogoNotWriteableInstruction",`<code>${this.pathUserLogoDirectory}</code><br/>`,`${this.pathUserLogo}, ${this.pathUserLogoSmall}, ${this.pathUserLogoSvg}`)},help(){if(!this.isPluginsAdminEnabled)return;const e=`"${Object(S["translate"])("General_GiveUsYourFeedback")}"`,t='<a href="?module=CorePluginsAdmin&action=plugins" rel="noreferrer noopener" target="_blank">';return Object(S["translate"])("CoreAdminHome_CustomLogoFeedbackInfo",e,t,"</a>")},pathUserLogoWithBuster(){return this.currentLogoSrcExists&&this.pathUserLogo?`${this.pathUserLogo}?${this.currentLogoCacheBuster}`:""},pathUserFaviconWithBuster(){return this.currentFaviconSrcExists&&this.pathUserFavicon?`${this.pathUserFavicon}?${this.currentFaviconCacheBuster}`:""}},methods:{onUseCustomLogoChange(e){this.enabled=e},onCustomLogoChange(e){this.customLogo=e,this.updateLogo()},onFaviconChange(e){this.customFavicon=e,this.updateLogo()},save(){this.isLoading=!0,S["AjaxHelper"].post({module:"API",method:"CoreAdminHome.setBrandingSettings"},{useCustomLogo:this.enabled?"1":"0"}).then(()=>{const e=S["NotificationsStore"].show({message:Object(S["translate"])("CoreAdminHome_SettingsSaveSuccess"),type:"transient",id:"generalSettings",context:"success"});S["NotificationsStore"].scrollToNotification(e)}).finally(()=>{this.isLoading=!1})},updateLogo(){const e=!!this.customLogo,t=!!this.customFavicon;if(!e&&!t)return;this.showUploadError=!1;const a="upload"+(new Date).getTime(),o=z(`<iframe name="${a}" />`);o.css("display","none"),o.on("load",()=>{setTimeout(()=>{const a=(z(o.contents()).find("body").html()||"").trim();"0"===a?this.showUploadError=!0:(e&&(this.currentLogoSrcExists=!0,this.currentLogoCacheBuster=(new Date).getTime()),t&&(this.currentFaviconSrcExists=!0,this.currentFaviconCacheBuster=(new Date).getTime())),"1"!==a&&"0"!==a||o.remove()},1e3)}),z("body:first").append(o);const n=z(this.$refs.logoUploadForm);n.attr("target",a),n.submit(),this.customLogo="",this.customFavicon=""}}});Q.render=K;var Y=Q;const X={id:"smtpSettings"};function Z(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("SaveButton"),c=Object(i["resolveComponent"])("ContentBlock"),d=Object(i["resolveDirective"])("form");return Object(i["openBlock"])(),Object(i["createBlock"])(c,{"content-title":e.translate("CoreAdminHome_EmailServerSettings"),anchor:"mailSettings"},{default:Object(i["withCtx"])(()=>[Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("div",null,[Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"mailUseSmtp",modelValue:e.enabled,"onUpdate:modelValue":t[0]||(t[0]=t=>e.enabled=t),title:e.translate("General_UseSMTPServerForEmail"),"inline-help":e.translate("General_SelectYesIfYouWantToSendEmailsViaServer")},null,8,["modelValue","title","inline-help"]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",X,[Object(i["createVNode"])(l,{uicontrol:"text",name:"mailHost","model-value":e.mailHost,"onUpdate:modelValue":t[1]||(t[1]=t=>e.onUpdateMailHost(t)),title:e.translate("General_SmtpServerAddress")},null,8,["model-value","title"]),Object(i["createVNode"])(l,{uicontrol:"text",name:"mailPort",modelValue:e.mailPort,"onUpdate:modelValue":t[2]||(t[2]=t=>e.mailPort=t),title:e.translate("General_SmtpPort"),"inline-help":e.translate("General_OptionalSmtpPort")},null,8,["modelValue","title","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"select",name:"mailType",modelValue:e.mailType,"onUpdate:modelValue":t[3]||(t[3]=t=>e.mailType=t),title:e.translate("General_AuthenticationMethodSmtp"),options:e.mailTypes,"inline-help":e.translate("General_OnlyUsedIfUserPwdIsSet")},null,8,["modelValue","title","options","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"text",name:"mailUsername",modelValue:e.mailUsername,"onUpdate:modelValue":t[4]||(t[4]=t=>e.mailUsername=t),title:e.translate("General_SmtpUsername"),"inline-help":e.translate("General_OnlyEnterIfRequired"),autocomplete:"off"},null,8,["modelValue","title","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"password",name:"mailPassword","model-value":e.mailPassword,"onUpdate:modelValue":t[5]||(t[5]=t=>e.onMailPasswordChange(t)),onClick:t[6]||(t[6]=t=>{!e.passwordChanged&&t.target.select()}),title:e.translate("General_SmtpPassword"),"inline-help":e.passwordHelp,autocomplete:"off"},null,8,["model-value","title","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"text",name:"mailFromAddress",modelValue:e.mailFromAddress,"onUpdate:modelValue":t[7]||(t[7]=t=>e.mailFromAddress=t),title:e.translate("General_SmtpFromAddress"),"inline-help":e.translate("General_SmtpFromEmailHelp",e.mailHost),autocomplete:"off"},null,8,["modelValue","title","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"text",name:"mailFromName",modelValue:e.mailFromName,"onUpdate:modelValue":t[8]||(t[8]=t=>e.mailFromName=t),title:e.translate("General_SmtpFromName"),"inline-help":e.translate("General_NameShownInTheSenderColumn"),autocomplete:"off"},null,8,["modelValue","title","inline-help"]),Object(i["createVNode"])(l,{uicontrol:"select",name:"mailEncryption",modelValue:e.mailEncryption,"onUpdate:modelValue":t[9]||(t[9]=t=>e.mailEncryption=t),title:e.translate("General_SmtpEncryption"),options:e.mailEncryptions,"inline-help":e.translate("General_EncryptedSmtpTransport")},null,8,["modelValue","title","options","inline-help"])],512),[[i["vShow"],e.enabled]]),Object(i["createVNode"])(s,{onConfirm:t[10]||(t[10]=t=>e.save()),saving:e.isLoading},null,8,["saving"])])),[[d]])]),_:1},8,["content-title"])}var ee=Object(i["defineComponent"])({props:{mail:{type:Object,required:!0},mailTypes:{type:Object,required:!0},mailEncryptions:{type:Object,required:!0}},data(){const e=this.mail;return{isLoading:!1,enabled:"smtp"===e.transport,mailHost:e.host,passwordChanged:!1,mailPort:e.port,mailType:e.type,mailUsername:e.username,mailPassword:e.password?"******":"",mailFromAddress:e.noreply_email_address,mailFromName:e.noreply_email_name,mailEncryption:e.encryption}},components:{ContentBlock:S["ContentBlock"],Field:y["Field"],SaveButton:y["SaveButton"]},directives:{Form:y["Form"]},computed:{passwordHelp(){const e=Object(S["translate"])("General_OnlyEnterIfRequiredPassword")+"<br/>",t=Object(S["translate"])("General_WarningPasswordStored","<strong>","</strong>")+"<br/>";return`${e}\n${t}`}},methods:{onUpdateMailHost(e){this.mailHost=e,this.passwordChanged||(this.mailPassword="",this.passwordChanged=!0)},onMailPasswordChange(e){this.mailPassword=e,this.passwordChanged=!0},save(){this.isLoading=!0;const e={mailUseSmtp:this.enabled?"1":"0",mailPort:this.mailPort,mailHost:this.mailHost,mailType:this.mailType,mailUsername:this.mailUsername,mailFromAddress:this.mailFromAddress,mailFromName:this.mailFromName,mailEncryption:this.mailEncryption};this.passwordChanged&&(e.mailPassword=this.mailPassword),S["AjaxHelper"].post({module:"CoreAdminHome",action:"setMailSettings"},e,{withTokenInUrl:!0}).then(()=>{const e=S["NotificationsStore"].show({message:Object(S["translate"])("CoreAdminHome_SettingsSaveSuccess"),type:"transient",id:"generalSettings",context:"success"});S["NotificationsStore"].scrollToNotification(e)}).finally(()=>{this.isLoading=!1})}}});ee.render=Z;var te=ee;const ae={id:"js-code-options"},oe=Object(i["createElementVNode"])("br",null,null,-1),ne=Object(i["createElementVNode"])("br",null,null,-1),ie=["innerHTML"],re=["innerHTML"],le=Object(i["createElementVNode"])("br",null,null,-1),se=Object(i["createElementVNode"])("br",null,null,-1),ce=["innerHTML"],de=Object(i["createElementVNode"])("br",null,null,-1),me=Object(i["createElementVNode"])("br",null,null,-1),ue=["innerHTML"],ge=Object(i["createElementVNode"])("br",null,null,-1),pe=Object(i["createElementVNode"])("br",null,null,-1),be=["href"],he=["href"],je=["href"],Oe=["href"],Ce=["href"],ve=["href"],ke=["href"],Ve={id:"javascript-output-section"},Ne={class:"valign-wrapper trackingHelpHeader matchWidth"},Te={id:"javascript-email-button"},fe={id:"javascript-text"},Se=["textContent"];function ye(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("JsTrackingCodeAdvancedOptions"),c=Object(i["resolveComponent"])("ContentBlock"),d=Object(i["resolveDirective"])("copy-to-clipboard");return Object(i["openBlock"])(),Object(i["createBlock"])(c,{anchor:"javaScriptTracking","content-title":e.translate("CoreAdminHome_JavaScriptTracking")},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",ae,[Object(i["createElementVNode"])("p",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTrackingIntro1"))+" ",1),oe,ne,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTrackingIntro2"))+" ",1),Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.jsTrackingIntro3a)},null,8,ie),Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(" "+e.jsTrackingIntro3b)},null,8,re),le,se,Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.jsTrackingIntro4a)},null,8,ce),de,me,Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.jsTrackingIntro5)},null,8,ue),ge,pe,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("SitesManager_InstallationGuides"))+" : ",1),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-install-the-matomo-tracking-code-on-wordpress/"),target:"_blank",rel:"noopener"},"WordPress",8,be),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-integrate-matomo-with-squarespace-website/"),target:"_blank",rel:"noopener"},"Squarespace",8,he),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-install-the-matomo-analytics-tracking-code-on-wix/"),target:"_blank",rel:"noopener"},"Wix",8,je),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/how-to-install/faq_19424/"),target:"_blank",rel:"noopener"},"SharePoint",8,Oe),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-install-the-matomo-analytics-tracking-code-on-joomla/"),target:"_blank",rel:"noopener"},"Joomla",8,Ce),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-install-the-matomo-tracking-code-on-my-shopify-store/"),target:"_blank",rel:"noopener"},"Shopify",8,ve),Object(i["createTextVNode"])(" | "),Object(i["createElementVNode"])("a",{href:e.externalRawLink("https://matomo.org/faq/new-to-piwik/how-do-i-use-matomo-analytics-within-gtm-google-tag-manager/"),target:"_blank",rel:"noopener"},"Google Tag Manager",8,ke)]),Object(i["createVNode"])(l,{uicontrol:"site",name:"js-tracker-website",class:"jsTrackingCodeWebsite",modelValue:e.site,"onUpdate:modelValue":t[0]||(t[0]=t=>e.site=t),ref:"site",introduction:e.translate("General_Website")},null,8,["modelValue","introduction"]),Object(i["createElementVNode"])("div",Ve,[Object(i["createElementVNode"])("div",Ne,[Object(i["createElementVNode"])("div",null,[Object(i["createElementVNode"])("h3",null,Object(i["toDisplayString"])(e.translate("General_JsTrackingTag")),1),Object(i["createElementVNode"])("p",null,Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_CodeNoteBeforeClosingHead","</head>")),1)]),Object(i["createElementVNode"])("div",Te,[Object(i["createElementVNode"])("button",{class:"btn",id:"emailJsBtn",onClick:t[1]||(t[1]=t=>e.sendEmail())},Object(i["toDisplayString"])(e.translate("SitesManager_EmailInstructionsButton")),1)])]),Object(i["createElementVNode"])("div",fe,[Object(i["createElementVNode"])("div",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("pre",{class:"codeblock",textContent:Object(i["toDisplayString"])(e.trackingCode),ref:"trackingCode"},null,8,Se),[[d,{}]])])])])]),Object(i["createVNode"])(s,{site:e.site,"max-custom-variables":e.maxCustomVariables,"server-side-do-not-track-enabled":e.serverSideDoNotTrackEnabled,onUpdateTrackingCode:e.updateTrackingCode},null,8,["site","max-custom-variables","server-side-do-not-track-enabled","onUpdateTrackingCode"])]),_:1},8,["content-title"])}const Ae={class:"trackingCodeAdvancedOptions"},Ee={class:"advance-option"},we=Object(i["createElementVNode"])("span",{class:"icon-chevron-down"},null,-1),_e=Object(i["createElementVNode"])("span",{class:"icon-chevron-up"},null,-1),He={id:"javascript-advanced-options"},De=["innerHTML"],xe={id:"optional-js-tracking-options"},Le={id:"jsTrackAllSubdomainsInlineHelp",class:"inline-help-node"},Be=["innerHTML"],Ue=["innerHTML"],Fe={id:"jsTrackGroupByDomainInlineHelp",class:"inline-help-node"},Ie={id:"jsTrackAllAliasesInlineHelp",class:"inline-help-node"},Me={id:"javascript-tracking-visitor-cv"},Pe={class:"row"},Ge={class:"col s12 m3"},Je={class:"col s12 m3"},$e={class:"col s12 m6 l3"},qe=["onKeydown"],Re={class:"col s12 m6 l3"},We=["onKeydown"],Ke={class:"row"},ze={class:"col s12"},Qe=Object(i["createElementVNode"])("span",{class:"icon-add"},null,-1),Ye={id:"jsCrossDomain",class:"inline-help-node"},Xe=Object(i["createElementVNode"])("br",null,null,-1),Ze={id:"jsDoNotTrackInlineHelp",class:"inline-help-node"},et={key:0},tt=Object(i["createElementVNode"])("br",null,null,-1),at=["innerHTML"],ot={id:"js-campaign-query-param-extra"},nt={class:"row"},it={class:"col s12"},rt={class:"row"},lt={class:"col s12"};function st(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("Field");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",Ae,[Object(i["createElementVNode"])("div",Ee,[Object(i["createElementVNode"])("span",null,[e.showAdvanced?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("a",{key:0,href:"javascript:;",onClick:t[0]||(t[0]=Object(i["withModifiers"])(t=>e.showAdvanced=!0,["prevent"]))},[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_ShowAdvancedOptions"))+" ",1),we])),e.showAdvanced?(Object(i["openBlock"])(),Object(i["createElementBlock"])("a",{key:1,href:"javascript:;",onClick:t[1]||(t[1]=Object(i["withModifiers"])(t=>e.showAdvanced=!1,["prevent"]))},[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_HideAdvancedOptions"))+" ",1),_e])):Object(i["createCommentVNode"])("",!0)])]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",He,[Object(i["createElementVNode"])("p",{innerHTML:e.$sanitize(e.trackingDocumentationHelp)},null,8,De),Object(i["createElementVNode"])("div",xe,[Object(i["createElementVNode"])("div",Le,[Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.mergeSubdomainsDesc)},null,8,Be),Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.learnMoreText)},null,8,Ue)]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-all-subdomains","model-value":e.trackAllSubdomains,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.trackAllSubdomains=t,e.updateTrackingCode()}),disabled:e.isLoading,title:`${e.translate("CoreAdminHome_JSTracking_MergeSubdomains")} ${e.currentSiteName}`,"inline-help":"#jsTrackAllSubdomainsInlineHelp"},null,8,["model-value","disabled","title"])]),Object(i["createElementVNode"])("div",Fe,Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_GroupPageTitlesByDomainDesc1",e.currentSiteHost)),1),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-group-by-domain","model-value":e.groupByDomain,"onUpdate:modelValue":t[3]||(t[3]=t=>{e.groupByDomain=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_GroupPageTitlesByDomain"),"inline-help":"#jsTrackGroupByDomainInlineHelp"},null,8,["model-value","disabled","title"]),Object(i["createElementVNode"])("div",Ie,Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_MergeAliasesDesc",e.currentSiteAlias)),1),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-all-aliases","model-value":e.trackAllAliases,"onUpdate:modelValue":t[4]||(t[4]=t=>{e.trackAllAliases=t,e.updateTrackingCode()}),disabled:e.isLoading,title:`${e.translate("CoreAdminHome_JSTracking_MergeAliases")} ${e.currentSiteName}`,"inline-help":"#jsTrackAllAliasesInlineHelp"},null,8,["model-value","disabled","title"]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-noscript","model-value":e.trackNoScript,"onUpdate:modelValue":t[5]||(t[5]=t=>{e.trackNoScript=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_TrackNoScript")},null,8,["model-value","disabled","title"]),Object(i["withDirectives"])(Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-visitor-cv-check","model-value":e.trackCustomVars,"onUpdate:modelValue":t[6]||(t[6]=t=>{e.trackCustomVars=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_VisitorCustomVars"),"inline-help":e.translate("CoreAdminHome_JSTracking_VisitorCustomVarsDesc")},null,8,["model-value","disabled","title","inline-help"]),[[i["vShow"],e.maxCustomVariables>0]]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",Me,[Object(i["createElementVNode"])("div",Pe,[Object(i["createElementVNode"])("div",Ge,Object(i["toDisplayString"])(e.translate("General_Name")),1),Object(i["createElementVNode"])("div",Je,Object(i["toDisplayString"])(e.translate("General_Value")),1)]),(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(e.customVars,(t,a)=>(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",{class:"row",key:a},[Object(i["createElementVNode"])("div",$e,[Object(i["createElementVNode"])("input",{type:"text",class:"custom-variable-name",onKeydown:t=>e.onCustomVarNameKeydown(t,a),placeholder:"e.g. Type"},null,40,qe)]),Object(i["createElementVNode"])("div",Re,[Object(i["createElementVNode"])("input",{type:"text",class:"custom-variable-value",onKeydown:t=>e.onCustomVarValueKeydown(t,a),placeholder:"e.g. Customer"},null,40,We)])]))),128)),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",Ke,[Object(i["createElementVNode"])("div",ze,[Object(i["createElementVNode"])("a",{href:"javascript:;",onClick:t[7]||(t[7]=t=>e.addCustomVar()),class:"add-custom-variable"},[Qe,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_Add")),1)])])],512),[[i["vShow"],e.canAddMoreCustomVariables]])],512),[[i["vShow"],e.trackCustomVars]]),Object(i["createElementVNode"])("div",Ye,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_CrossDomain"))+" ",1),Xe,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_CrossDomain_NeedsMultipleDomains")),1)]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-cross-domain","model-value":e.crossDomain,"onUpdate:modelValue":t[8]||(t[8]=t=>{e.crossDomain=t,e.updateTrackingCode(),e.onCrossDomainToggle()}),disabled:e.isLoading||!e.hasManySiteUrls,title:e.translate("CoreAdminHome_JSTracking_EnableCrossDomainLinking"),"inline-help":"#jsCrossDomain"},null,8,["model-value","disabled","title"]),Object(i["createElementVNode"])("div",Ze,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_EnableDoNotTrackDesc"))+" ",1),e.serverSideDoNotTrackEnabled?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",et,[tt,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("CoreAdminHome_JSTracking_EnableDoNotTrack_AlreadyEnabled")),1)])):Object(i["createCommentVNode"])("",!0)]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-do-not-track","model-value":e.doNotTrack,"onUpdate:modelValue":t[9]||(t[9]=t=>{e.doNotTrack=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_EnableDoNotTrack"),"inline-help":"#jsDoNotTrackInlineHelp"},null,8,["model-value","disabled","title"]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"javascript-tracking-disable-cookies","model-value":e.disableCookies,"onUpdate:modelValue":t[10]||(t[10]=t=>{e.disableCookies=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_DisableCookies"),"inline-help":e.translate("CoreAdminHome_JSTracking_DisableCookiesDesc")},null,8,["model-value","disabled","title","inline-help"]),Object(i["createElementVNode"])("div",{id:"jsTrackCampaignParamsInlineHelp",class:"inline-help-node",innerHTML:e.$sanitize(e.jsTrackCampaignParamsInlineHelp)},null,8,at),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"custom-campaign-query-params-check","model-value":e.useCustomCampaignParams,"onUpdate:modelValue":t[11]||(t[11]=t=>{e.useCustomCampaignParams=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_CustomCampaignQueryParam"),"inline-help":"#jsTrackCampaignParamsInlineHelp"},null,8,["model-value","disabled","title"]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",ot,[Object(i["createElementVNode"])("div",nt,[Object(i["createElementVNode"])("div",it,[Object(i["createVNode"])(l,{uicontrol:"text",name:"custom-campaign-name-query-param","model-value":e.customCampaignName,"onUpdate:modelValue":t[12]||(t[12]=t=>{e.customCampaignName=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_CampaignNameParam")},null,8,["model-value","disabled","title"])])]),Object(i["createElementVNode"])("div",rt,[Object(i["createElementVNode"])("div",lt,[Object(i["createVNode"])(l,{uicontrol:"text",name:"custom-campaign-keyword-query-param","model-value":e.customCampaignKeyword,"onUpdate:modelValue":t[13]||(t[13]=t=>{e.customCampaignKeyword=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_CampaignKwdParam")},null,8,["model-value","disabled","title"])])])],512),[[i["vShow"],e.useCustomCampaignParams]]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"require-consent-for-campaign-tracking","model-value":e.disableCampaignParameters,"onUpdate:modelValue":t[14]||(t[14]=t=>{e.disableCampaignParameters=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_JSTracking_DisableCampaignParameters"),"inline-help":e.translate("CoreAdminHome_JSTracking_DisableCampaignParametersDesc")},null,8,["model-value","disabled","title","inline-help"])],512),[[i["vShow"],e.showAdvanced]])])}function ct(e){const t=new URL(e);return t.hostname}function dt(e){return e.filter(e=>!!e.name).map(e=>[e.name,e.value])}const mt=window.location.host,ut=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));var gt=Object(i["defineComponent"])({props:{site:{type:Object,required:!0},maxCustomVariables:Number,serverSideDoNotTrackEnabled:Boolean},data(){return{showAdvanced:!1,trackAllSubdomains:!1,isLoading:!1,siteUrls:{},siteExcludedQueryParams:{},siteExcludedReferrers:{},crossDomain:!1,groupByDomain:!1,trackAllAliases:!1,trackNoScript:!1,trackCustomVars:!1,customVars:[],canAddMoreCustomVariables:!!this.maxCustomVariables&&this.maxCustomVariables>0,doNotTrack:!1,disableCookies:!1,useCustomCampaignParams:!1,customCampaignName:"",customCampaignKeyword:"",trackingCodeAbortController:null,disableCampaignParameters:!1}},emits:["updateTrackingCode"],components:{Field:y["Field"]},created(){this.site&&this.site.id&&this.onSiteChanged(this.site),this.onCustomVarNameKeydown=Object(S["debounce"])(this.onCustomVarNameKeydown,100),this.onCustomVarValueKeydown=Object(S["debounce"])(this.onCustomVarValueKeydown,100),this.addCustomVar()},watch:{site(e){this.onSiteChanged(e)}},methods:{onSiteChanged(e){const t=e.id,a=[];this.siteUrls[t]||(this.isLoading=!0,a.push(S["AjaxHelper"].fetch({module:"API",method:"SitesManager.getSiteUrlsFromId",idSite:t,filter_limit:"-1"}).then(e=>{this.siteUrls[t]=e||[]}))),this.siteExcludedQueryParams[t]||(this.isLoading=!0,a.push(S["AjaxHelper"].fetch({module:"API",method:"SitesManager.getExcludedQueryParameters",idSite:t,filter_limit:"-1"}).then(e=>{this.siteExcludedQueryParams[t]=e||[]}))),this.siteExcludedReferrers[t]||(this.isLoading=!0,a.push(S["AjaxHelper"].fetch({module:"API",method:"SitesManager.getExcludedReferrers",idSite:t,filter_limit:"-1"}).then(e=>{this.siteExcludedReferrers[t]=[],Object.values(e||[]).forEach(e=>{this.siteExcludedReferrers[t].push(e.replace(/^https?:\/\//,""))})}))),Promise.all(a).then(()=>{this.isLoading=!1,this.updateCurrentSiteInfo(),this.updateTrackingCode()})},updateCurrentSiteInfo(){this.hasManySiteUrls||(this.crossDomain=!1)},onCrossDomainToggle(){this.crossDomain&&(this.trackAllAliases=!0)},updateTrackingCode(){const e={piwikUrl:`${mt}${ut}`,groupPageTitlesByDomain:this.groupByDomain?1:0,mergeSubdomains:this.trackAllSubdomains?1:0,mergeAliasUrls:this.trackAllAliases?1:0,visitorCustomVariables:this.trackCustomVars?dt(this.customVars):0,customCampaignNameQueryParam:null,customCampaignKeywordParam:null,doNotTrack:this.doNotTrack?1:0,disableCookies:this.disableCookies?1:0,crossDomain:this.crossDomain?1:0,trackNoScript:this.trackNoScript?1:0,forceMatomoEndpoint:1,disableCampaignParameters:this.disableCampaignParameters?1:0};this.siteExcludedQueryParams[this.site.id]&&(e.excludedQueryParams=this.siteExcludedQueryParams[this.site.id]),this.siteExcludedReferrers[this.site.id]&&(e.excludedReferrers=this.siteExcludedReferrers[this.site.id]),this.useCustomCampaignParams&&(e.customCampaignNameQueryParam=this.customCampaignName,e.customCampaignKeywordParam=this.customCampaignKeyword),this.trackingCodeAbortController&&(this.trackingCodeAbortController.abort(),this.trackingCodeAbortController=null),this.trackingCodeAbortController=new AbortController,S["AjaxHelper"].post({module:"API",format:"json",method:"SitesManager.getJavascriptTag",idSite:this.site.id},e,{abortController:this.trackingCodeAbortController}).then(e=>{this.trackingCodeAbortController=null,this.$emit("updateTrackingCode",e.value)})},addCustomVar(){this.canAddMoreCustomVariables&&this.customVars.push({name:"",value:""}),this.canAddMoreCustomVariables=!!this.maxCustomVariables&&this.maxCustomVariables>this.customVars.length},onCustomVarNameKeydown(e,t){setTimeout(()=>{this.customVars[t].name=e.target.value,this.updateTrackingCode()})},onCustomVarValueKeydown(e,t){setTimeout(()=>{this.customVars[t].value=e.target.value,this.updateTrackingCode()})}},computed:{hasManySiteUrls(){const{site:e}=this;return this.siteUrls[e.id]&&this.siteUrls[e.id].length>1},currentSiteHost(){var e;const t=null===(e=this.siteUrls[this.site.id])||void 0===e?void 0:e[0];return t?ct(t):""},currentSiteAlias(){var e;const t="x."+this.currentSiteHost,a=null===(e=this.siteUrls[this.site.id])||void 0===e?void 0:e[1];return a||t},currentSiteName(){return S["Matomo"].helper.htmlEntities(this.site.name)},mergeSubdomainsDesc(){return Object(S["translate"])("CoreAdminHome_JSTracking_MergeSubdomainsDesc","x."+this.currentSiteHost,"y."+this.currentSiteHost)},learnMoreText(){const e=Object(S["externalRawLink"])("https://developer.matomo.org/guides/tracking-javascript-guide")+"#measuring-domains-andor-sub-domains";return Object(S["translate"])("General_LearnMore",` (<a href="${e}" rel="noreferrer noopener" target="_blank">`,"</a>)")},jsTrackCampaignParamsInlineHelp(){return Object(S["translate"])("CoreAdminHome_JSTracking_CustomCampaignQueryParamDesc",Object(S["externalLink"])("https://matomo.org/faq/general/faq_119"),"</a>")},trackingDocumentationHelp(){return Object(S["translate"])("CoreAdminHome_JSTrackingDocumentationHelp",Object(S["externalLink"])("https://developer.matomo.org/guides/tracking-javascript-guide"),"</a>")}}});gt.render=st;var pt=gt,bt=Object(i["defineComponent"])({props:{defaultSite:{type:Object,required:!0},maxCustomVariables:Number,serverSideDoNotTrackEnabled:Boolean},data(){return{site:this.defaultSite,trackingCode:"",isHighlighting:!1,consentManagerName:"",consentManagerUrl:"",consentManagerIsConnected:!1}},components:{JsTrackingCodeAdvancedOptions:pt,ContentBlock:S["ContentBlock"],Field:y["Field"]},directives:{CopyToClipboard:S["CopyToClipboard"]},created(){this.site&&this.site.id&&this.onSiteChanged(this.site)},watch:{site(e){this.onSiteChanged(e)}},methods:{updateTrackingCode(e){this.trackingCode=e;const t=$(this.$refs.trackingCode);t&&!this.isHighlighting&&(this.isHighlighting=!0,t.effect("highlight",{complete:()=>{this.isHighlighting=!1}},1500))},onSiteChanged(e){const t=e.id;S["AjaxHelper"].fetch({module:"API",format:"json",method:"SitesManager.detectConsentManager",idSite:t,filter_limit:"-1"}).then(e=>{Object.prototype.hasOwnProperty.call(e,"name")&&(this.consentManagerName=e.name),Object.prototype.hasOwnProperty.call(e,"url")&&(this.consentManagerUrl=e.url),this.consentManagerIsConnected=e.isConnected})},sendEmail(){let e=Object(S["translate"])("SitesManager_EmailInstructionsSubject");e=encodeURIComponent(e);let{trackingCode:t}=this;t=t.replace(/<[^>]+>/g,"");let a=`${Object(S["translate"])("SitesManager_JsTrackingTagHelp")}. ${Object(S["translate"])("CoreAdminHome_JSTracking_CodeNoteBeforeClosingHeadEmail","'head")}\n${t}`;""!==this.consentManagerName&&""!==this.consentManagerUrl&&(a+=Object(S["translate"])("CoreAdminHome_JSTracking_ConsentManagerDetected",this.consentManagerName,this.consentManagerUrl),this.consentManagerIsConnected&&(a+="\n"+Object(S["translate"])("CoreAdminHome_JSTracking_ConsentManagerConnected",this.consentManagerName))),a=encodeURIComponent(a);const o=`mailto:?subject=${e}&body=${a}`;window.location.href=o}},computed:{jsTrackingIntro3a(){return Object(S["translate"])("CoreAdminHome_JSTrackingIntro3a",Object(S["externalLink"])("https://matomo.org/integrate/"),"</a>")},jsTrackingIntro3b(){return Object(S["translate"])("CoreAdminHome_JSTrackingIntro3b")},jsTrackingIntro4a(){return Object(S["translate"])("CoreAdminHome_JSTrackingIntro4",'<a href="#image-tracking-link">',"</a>")},jsTrackingIntro5(){return Object(S["translate"])("CoreAdminHome_JSTrackingIntro5",Object(S["externalLink"])("https://developer.matomo.org/guides/tracking-javascript-guide"),"</a>")}}});bt.render=ye;var ht=bt;const jt={class:"list-style-decimal"},Ot={id:"javascript-text"},Ct=["textContent"],vt={key:0};function kt(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("JsTrackingCodeAdvancedOptions"),s=Object(i["resolveDirective"])("copy-to-clipboard");return Object(i["openBlock"])(),Object(i["createElementBlock"])("ol",jt,[Object(i["createElementVNode"])("li",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_JsTrackingCodeAdvancedOptionsStep"))+" ",1),Object(i["createVNode"])(l,{site:e.site,"max-custom-variables":e.maxCustomVariables,"server-side-do-not-track-enabled":e.serverSideDoNotTrackEnabled,onUpdateTrackingCode:e.updateTrackingCode},null,8,["site","max-custom-variables","server-side-do-not-track-enabled","onUpdateTrackingCode"])]),Object(i["createElementVNode"])("li",null,[Object(i["createElementVNode"])("span",null,Object(i["toDisplayString"])(e.getCopyCodeStep),1),Object(i["createElementVNode"])("div",Ot,[Object(i["createElementVNode"])("div",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("pre",{class:"codeblock",textContent:Object(i["toDisplayString"])(e.trackingCode),ref:"trackingCode"},null,8,Ct),[[s,{}]])])])]),e.isJsTrackerInstallCheckAvailable?(Object(i["openBlock"])(),Object(i["createElementBlock"])("li",vt,[(Object(i["openBlock"])(),Object(i["createBlock"])(Object(i["resolveDynamicComponent"])(e.testComponent),{site:e.site},null,8,["site"]))])):Object(i["createCommentVNode"])("",!0)])}var Vt=Object(i["defineComponent"])({props:{defaultSite:{type:Object,required:!0},maxCustomVariables:Number,serverSideDoNotTrackEnabled:Boolean,jsTag:String,isJsTrackerInstallCheckAvailable:Boolean},components:{JsTrackingCodeAdvancedOptions:pt},directives:{CopyToClipboard:S["CopyToClipboard"]},data(){return{site:this.defaultSite,trackingCode:"",isHighlighting:!1}},created(){this.jsTag&&(this.trackingCode=this.jsTag)},methods:{updateTrackingCode(e){this.trackingCode=e;const t=$(this.$refs.trackingCode);t&&!this.isHighlighting&&(this.isHighlighting=!0,t.effect("highlight",{complete:()=>{this.isHighlighting=!1}},1500))}},computed:{getCopyCodeStep(){return Object(S["translate"])("CoreAdminHome_JSTracking_CodeNoteBeforeClosingHead","</head>")},testComponent(){return this.isJsTrackerInstallCheckAvailable?Object(S["useExternalPluginComponent"])("JsTrackerInstallCheck","JsTrackerInstallCheck"):""}}});Vt.render=kt;var Nt=Vt;const Tt=Object(i["createElementVNode"])("a",{name:"image-tracking-link"},null,-1),ft={id:"image-tracking-code-options"},St=["innerHTML"],yt=["innerHTML"],At={id:"image-tracking-goal-sub"},Et={class:"row"},wt={class:"col s12 m6"},_t={class:"col s12 m6"},Ht={id:"image-link-output-section"},Dt={id:"image-tracking-text"},xt=["textContent"];function Lt(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("ContentBlock"),c=Object(i["resolveDirective"])("copy-to-clipboard");return Object(i["openBlock"])(),Object(i["createBlock"])(s,{"content-title":e.translate("CoreAdminHome_ImageTracking"),anchor:"imageTracking"},{default:Object(i["withCtx"])(()=>[Tt,Object(i["createElementVNode"])("div",ft,[Object(i["createElementVNode"])("p",{innerHTML:e.$sanitize(e.imageTrackingIntro)},null,8,St),Object(i["createElementVNode"])("p",{innerHTML:e.$sanitize(e.imageTrackingIntro3)},null,8,yt),Object(i["createVNode"])(l,{uicontrol:"site",name:"image-tracker-website",modelValue:e.site,"onUpdate:modelValue":t[0]||(t[0]=t=>e.site=t),introduction:e.translate("General_Website")},null,8,["modelValue","introduction"]),Object(i["createVNode"])(l,{uicontrol:"text",name:"image-tracker-action-name","model-value":e.pageName,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.pageName=t,e.updateTrackingCode()}),disabled:e.isLoading,introduction:e.translate("General_Options"),title:e.translate("Actions_ColumnPageName")},null,8,["model-value","disabled","introduction","title"]),Object(i["createVNode"])(l,{uicontrol:"checkbox",name:"image-tracking-goal-check","model-value":e.trackGoal,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.trackGoal=t,e.updateTrackingCode()}),disabled:e.isLoading,title:e.translate("CoreAdminHome_TrackAGoal")},null,8,["model-value","disabled","title"]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",At,[Object(i["createElementVNode"])("div",Et,[Object(i["createElementVNode"])("div",wt,[Object(i["createVNode"])(l,{uicontrol:"select",name:"image-tracker-goal",options:e.siteGoals,disabled:e.isLoading,"model-value":e.trackIdGoal,"onUpdate:modelValue":t[3]||(t[3]=t=>{e.trackIdGoal=t,e.updateTrackingCode()})},null,8,["options","disabled","model-value"])]),Object(i["createElementVNode"])("div",_t,[Object(i["createVNode"])(l,{uicontrol:"text",name:"image-revenue","model-value":e.revenue,"onUpdate:modelValue":t[4]||(t[4]=t=>{e.revenue=t,e.updateTrackingCode()}),disabled:e.isLoading,"full-width":!0,title:`${e.translate("CoreAdminHome_WithOptionalRevenue")} ${e.currentSiteCurrency}`},null,8,["model-value","disabled","title"])])])],512),[[i["vShow"],e.trackGoal]]),Object(i["createElementVNode"])("div",Ht,[Object(i["createElementVNode"])("h3",null,Object(i["toDisplayString"])(e.translate("CoreAdminHome_ImageTrackingLink")),1),Object(i["createElementVNode"])("div",Dt,[Object(i["createElementVNode"])("div",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("pre",{textContent:Object(i["toDisplayString"])(e.trackingCode),ref:"trackingCode"},null,8,xt),[[c,{}]])])])])])]),_:1},8,["content-title"])}let Bt=null;const{$:Ut}=window,Ft=window.location.host,It=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));var Mt=Object(i["defineComponent"])({props:{defaultSite:{type:Object,required:!0}},components:{ContentBlock:S["ContentBlock"],Field:y["Field"]},directives:{CopyToClipboard:S["CopyToClipboard"]},data(){return{isLoading:!1,site:this.defaultSite,pageName:"",trackGoal:!1,trackIdGoal:null,revenue:"",trackingCode:"",sites:{},goals:{},trackingCodeAbortController:null,isHighlighting:!1}},created(){this.updateTrackingCode=Object(S["debounce"])(this.updateTrackingCode),this.site&&this.site.id&&this.onSiteChanged(this.site)},watch:{site(e){this.onSiteChanged(e)}},methods:{onSiteChanged(e){let t,a,o;return this.trackIdGoal=null,Bt?t=Promise.resolve(Bt):(this.isLoading=!0,t=S["AjaxHelper"].fetch({method:"SitesManager.getCurrencySymbols",filter_limit:"-1"})),this.sites[e.id]?a=Promise.resolve(this.sites[e.id]):(this.isLoading=!0,a=S["AjaxHelper"].fetch({module:"API",method:"SitesManager.getSiteFromId",idSite:e.id})),this.goals[e.id]?o=Promise.resolve(this.goals[e.id]):(this.isLoading=!0,o=S["AjaxHelper"].fetch({module:"API",method:"Goals.getGoals",filter_limit:"-1",idSite:e.id})),Promise.all([t,a,o]).then(([t,a,o])=>{this.isLoading=!1,Bt=t,this.sites[e.id]=a,this.goals[e.id]=o,this.updateTrackingCode()})},updateTrackingCode(){const e={piwikUrl:`${Ft}${It}`,actionName:this.pageName,forceMatomoEndpoint:1};this.trackGoal&&this.trackIdGoal&&(e.idGoal=this.trackIdGoal,e.revenue=this.revenue),this.trackingCodeAbortController&&(this.trackingCodeAbortController.abort(),this.trackingCodeAbortController=null),this.trackingCodeAbortController=new AbortController,S["AjaxHelper"].post({module:"API",format:"json",method:"SitesManager.getImageTrackingCode",idSite:this.site.id},e,{abortController:this.trackingCodeAbortController}).then(e=>{this.trackingCodeAbortController=null,this.trackingCode=e.value;const t=Ut(this.$refs.trackingCode);t&&!this.isHighlighting&&(this.isHighlighting=!0,t.effect("highlight",{complete:()=>{this.isHighlighting=!1}},1500))})}},computed:{currentSiteCurrency(){return Bt?Bt[(this.sites[this.site.id].currency||"").toUpperCase()]:""},siteGoals(){const e=this.goals[this.site.id];return[{key:"",value:Object(S["translate"])("UserCountryMap_None")}].concat(Object.values(e||[]).map(e=>({key:""+e.idgoal,value:e.name})))},imageTrackingIntro(){const e=Object(S["translate"])("CoreAdminHome_ImageTrackingIntro1"),t=Object(S["translate"])("CoreAdminHome_ImageTrackingIntro2","<code>&lt;noscript&gt;&lt;/noscript&gt;</code>");return`${e} ${t}`},imageTrackingIntro3(){const e=Object(S["externalRawLink"])("https://matomo.org/docs/tracking-api/reference/");return Object(S["translate"])("CoreAdminHome_ImageTrackingIntro3",`<a href="${e}" rel="noreferrer noopener" target="_blank">`,"</a>")}}});Mt.render=Lt;var Pt=Mt;const Gt=Object(i["createElementVNode"])("br",null,null,-1),Jt=Object(i["createElementVNode"])("br",null,null,-1),$t=["value"],qt={class:"action"},Rt={colspan:"7"},Wt=Object(i["createElementVNode"])("span",{class:"icon-ok"},null,-1),Kt={class:"ui-confirm",id:"confirmDeleteAllTrackingFailures"},zt=["value"],Qt=["value"],Yt={class:"ui-confirm",id:"confirmDeleteThisTrackingFailure"},Xt=["value"],Zt=["value"];function ea(e,t,a,o,n,r){const l=Object(i["resolveComponent"])("ActivityIndicator"),s=Object(i["resolveComponent"])("FailureRow"),c=Object(i["resolveComponent"])("ContentBlock"),d=Object(i["resolveDirective"])("content-table");return Object(i["openBlock"])(),Object(i["createBlock"])(c,{class:"matomoTrackingFailures","content-title":e.translate("CoreAdminHome_TrackingFailures")},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("p",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_TrackingFailuresIntroduction","2"))+" ",1),Gt,Jt,Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{class:"btn deleteAllFailures",type:"button",onClick:t[0]||(t[0]=t=>e.deleteAll()),value:e.translate("CoreAdminHome_DeleteAllFailures")},null,8,$t),[[i["vShow"],!e.isLoading&&e.failures.length>0]])]),Object(i["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("table",null,[Object(i["createElementVNode"])("thead",null,[Object(i["createElementVNode"])("tr",null,[Object(i["createElementVNode"])("th",{onClick:t[1]||(t[1]=t=>e.changeSortOrder("idsite"))},Object(i["toDisplayString"])(e.translate("General_Measurable")),1),Object(i["createElementVNode"])("th",{onClick:t[2]||(t[2]=t=>e.changeSortOrder("problem"))},Object(i["toDisplayString"])(e.translate("CoreAdminHome_Problem")),1),Object(i["createElementVNode"])("th",{onClick:t[3]||(t[3]=t=>e.changeSortOrder("solution"))},Object(i["toDisplayString"])(e.translate("CoreAdminHome_Solution")),1),Object(i["createElementVNode"])("th",{onClick:t[4]||(t[4]=t=>e.changeSortOrder("date_first_occurred"))},Object(i["toDisplayString"])(e.translate("General_Date")),1),Object(i["createElementVNode"])("th",{onClick:t[5]||(t[5]=t=>e.changeSortOrder("url"))},Object(i["toDisplayString"])(e.translate("Actions_ColumnPageURL")),1),Object(i["createElementVNode"])("th",{onClick:t[6]||(t[6]=t=>e.changeSortOrder("request_url"))},Object(i["toDisplayString"])(e.translate("CoreAdminHome_TrackingURL")),1),Object(i["createElementVNode"])("th",qt,Object(i["toDisplayString"])(e.translate("General_Action")),1)])]),Object(i["createElementVNode"])("tbody",null,[Object(i["createElementVNode"])("tr",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("td",Rt,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("CoreAdminHome_NoKnownFailures"))+" ",1),Wt],512),[[i["vShow"],!e.isLoading&&0===e.failures.length]])]),(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(e.sortedFailures,(a,o)=>(Object(i["openBlock"])(),Object(i["createElementBlock"])("tr",{key:o},[Object(i["createVNode"])(s,{failure:a,onDelete:t[7]||(t[7]=t=>e.deleteFailure(t.idSite,t.idFailure))},null,8,["failure"])]))),128))])])),[[d]]),Object(i["createElementVNode"])("div",Kt,[Object(i["createElementVNode"])("h2",null,Object(i["toDisplayString"])(e.translate("CoreAdminHome_ConfirmDeleteAllTrackingFailures")),1),Object(i["createElementVNode"])("input",{type:"button",role:"yes",value:e.translate("General_Yes")},null,8,zt),Object(i["createElementVNode"])("input",{type:"button",role:"no",value:e.translate("General_No")},null,8,Qt)]),Object(i["createElementVNode"])("div",Yt,[Object(i["createElementVNode"])("h2",null,Object(i["toDisplayString"])(e.translate("CoreAdminHome_ConfirmDeleteThisTrackingFailure")),1),Object(i["createElementVNode"])("input",{type:"button",role:"yes",value:e.translate("General_Yes")},null,8,Xt),Object(i["createElementVNode"])("input",{type:"button",role:"no",value:e.translate("General_No")},null,8,Zt)])]),_:1},8,["content-title"])}const ta=["href"],aa={class:"datetime"},oa=["title"],na=["title"];function ia(e,t,a,o,n,r){return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createElementVNode"])("td",null,Object(i["toDisplayString"])(e.failure.site_name)+" ("+Object(i["toDisplayString"])(e.translate("General_Id"))+" "+Object(i["toDisplayString"])(e.failure.idsite)+")",1),Object(i["createElementVNode"])("td",null,Object(i["toDisplayString"])(e.failure.problem),1),Object(i["createElementVNode"])("td",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.failure.solution)+" ",1),Object(i["withDirectives"])(Object(i["createElementVNode"])("a",{rel:"noopener noreferrer",href:e.failure.solution_url},Object(i["toDisplayString"])(e.translate("CoreAdminHome_LearnMore")),9,ta),[[i["vShow"],e.failure.solution_url]])]),Object(i["createElementVNode"])("td",aa,Object(i["toDisplayString"])(e.failure.pretty_date_first_occurred),1),Object(i["createElementVNode"])("td",null,Object(i["toDisplayString"])(e.failure.url),1),Object(i["createElementVNode"])("td",null,[Object(i["withDirectives"])(Object(i["createElementVNode"])("span",{onClick:t[0]||(t[0]=t=>e.showFullRequestUrl=!0),title:e.translate("CoreHome_ClickToSeeFullInformation")},Object(i["toDisplayString"])(e.limtedRequestUrl)+"...",9,oa),[[i["vShow"],!e.showFullRequestUrl]]),Object(i["withDirectives"])(Object(i["createElementVNode"])("span",null,Object(i["toDisplayString"])(e.failure.request_url),513),[[i["vShow"],e.failure.showFullRequestUrl]])]),Object(i["createElementVNode"])("td",null,[Object(i["createElementVNode"])("span",{class:"table-action icon-delete",onClick:t[1]||(t[1]=t=>e.deleteFailure(e.failure.idsite,e.failure.idfailure)),title:e.translate("General_Delete")},null,8,na)])],64)}var ra=Object(i["defineComponent"])({props:{failure:{type:Object,required:!0}},emits:["delete"],data(){return{showFullRequestUrl:!1}},computed:{limtedRequestUrl(){return this.failure.request_url.substring(0,100)}},methods:{deleteFailure(e,t){this.$emit("delete",{idSite:e,idFailure:t})}}});ra.render=ia;var la=ra,sa=Object(i["defineComponent"])({components:{ContentBlock:S["ContentBlock"],ActivityIndicator:S["ActivityIndicator"],FailureRow:la},directives:{ContentTable:S["ContentTable"]},data(){return{failures:[],sortColumn:"idsite",sortReverse:!1,isLoading:!1}},created(){this.fetchAll()},methods:{changeSortOrder(e){this.sortColumn===e?this.sortReverse=!this.sortReverse:this.sortColumn=e},fetchAll(){this.failures=[],this.isLoading=!0,S["AjaxHelper"].fetch({method:"CoreAdminHome.getTrackingFailures",filter_limit:"-1"}).then(e=>{this.failures=e,this.isLoading=!1}).finally(()=>{this.isLoading=!1})},deleteAll(){S["Matomo"].helper.modalConfirm("#confirmDeleteAllTrackingFailures",{yes:()=>{this.failures=[],S["AjaxHelper"].fetch({method:"CoreAdminHome.deleteAllTrackingFailures"}).then(()=>{this.fetchAll()})}})},deleteFailure(e,t){S["Matomo"].helper.modalConfirm("#confirmDeleteThisTrackingFailure",{yes:()=>{this.failures=[],S["AjaxHelper"].fetch({method:"CoreAdminHome.deleteTrackingFailure",idSite:e,idFailure:t}).then(()=>{this.fetchAll()})}})}},computed:{sortedFailures(){const{sortColumn:e}=this,t=[...this.failures];return this.sortReverse?t.sort((t,a)=>t[e]>a[e]?-1:t[e]<a[e]?1:0):t.sort((t,a)=>t[e]<a[e]?-1:t[e]>a[e]?1:0),t}}});sa.render=ea;var ca=sa;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
*/}})}));
//# sourceMappingURL=CoreAdminHome.umd.min.js.map