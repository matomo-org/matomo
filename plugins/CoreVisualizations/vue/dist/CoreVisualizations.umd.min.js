(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["CoreVisualizations"]=t(require("CoreHome"),require("vue")):e["CoreVisualizations"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/CoreVisualizations/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"SeriesPicker",(function(){return h})),n.d(t,"SingleMetricView",(function(){return T})),"undefined"!==typeof window){var o=window.document.currentScript,r=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(n.p=r[1])}var c=n("8bbf"),a={key:0,class:"jqplot-seriespicker-popover"},l={class:"headline"},i=["onClick"],u=["type","checked"],s={key:0,class:"headline recordsToPlot"},m=["onClick"],d=["type","checked"];function f(e,t,n,o,r,f){return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:Object(c["normalizeClass"])(["jqplot-seriespicker",{open:e.isPopupVisible}]),onMouseenter:t[1]||(t[1]=function(t){return e.isPopupVisible=!0}),onMouseleave:t[2]||(t[2]=function(t){return e.onLeavePopup()})},[Object(c["createElementVNode"])("a",{href:"#",onClick:t[0]||(t[0]=Object(c["withModifiers"])((function(){}),["prevent","stop"]))}," + "),e.isPopupVisible?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",a,[Object(c["createElementVNode"])("p",l,Object(c["toDisplayString"])(e.translate(e.multiselect?"General_MetricsToPlot":"General_MetricToPlot")),1),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.selectableColumns,(function(t){return Object(c["openBlock"])(),Object(c["createElementBlock"])("p",{class:"pickColumn",onClick:function(n){return e.optionSelected(t.column,e.columnStates)},key:t.column},[Object(c["createElementVNode"])("label",null,[Object(c["createElementVNode"])("input",{class:"select",type:e.multiselect?"checkbox":"radio",checked:!!e.columnStates[t.column]},null,8,u),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(t.translation),1)])],8,i)})),128)),e.selectableRows.length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("p",s,Object(c["toDisplayString"])(e.translate("General_RecordsToPlot")),1)):Object(c["createCommentVNode"])("",!0),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.selectableRows,(function(t){return Object(c["openBlock"])(),Object(c["createElementBlock"])("p",{class:"pickRow",onClick:function(n){return e.optionSelected(t.matcher,e.rowStates)},key:t.matcher},[Object(c["createElementVNode"])("label",null,[Object(c["createElementVNode"])("input",{class:"select",type:e.multiselect?"checkbox":"radio",checked:!!e.rowStates[t.matcher]},null,8,d),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(t.label),1)])],8,m)})),128))])):Object(c["createCommentVNode"])("",!0)],34)}var p=n("19dc");function b(e,t){var n={};return e.forEach((function(e){var t=e.column||e.matcher;n[t]=!1})),t.forEach((function(e){n[e]=!0})),n}function v(e,t){return e.length===t.length&&0===e.filter((function(e){return-1===t.indexOf(e)})).length}function j(e){Object.keys(e).forEach((function(t){e[t]=!1}))}function O(e){return Object.keys(e).filter((function(t){return!!e[t]}))}var g=Object(c["defineComponent"])({props:{multiselect:Boolean,selectableColumns:{type:Array,default:function(){return[]}},selectableRows:{type:Array,default:function(){return[]}},selectedColumns:{type:Array,default:function(){return[]}},selectedRows:{type:Array,default:function(){return[]}}},data:function(){return{isPopupVisible:!1,columnStates:b(this.selectableColumns,this.selectedColumns),rowStates:b(this.selectableRows,this.selectedRows)}},emits:["select"],created:function(){this.optionSelected=Object(p["debounce"])(this.optionSelected,0)},methods:{optionSelected:function(e,t){this.multiselect||(j(this.columnStates),j(this.rowStates)),t[e]=!t[e],this.triggerOnSelectAndClose()},onLeavePopup:function(){this.isPopupVisible=!1,this.optionsChanged()&&this.triggerOnSelectAndClose()},triggerOnSelectAndClose:function(){this.isPopupVisible=!1,this.$emit("select",{columns:O(this.columnStates),rows:O(this.rowStates)})},optionsChanged:function(){return!v(O(this.columnStates),this.selectedColumns)||!v(O(this.rowStates),this.selectedRows)}}});g.render=f;var h=g,y={class:"metric-sparkline"},S={class:"metric-value"},k=["title"],w=["title"];function V(e,t,n,o,r,a){var l=Object(c["resolveComponent"])("Sparkline");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:Object(c["normalizeClass"])(["singleMetricView",{loading:e.isLoading}]),ref:"root"},[Object(c["createElementVNode"])("div",y,[Object(c["createVNode"])(l,{params:e.sparklineParams},null,8,["params"])]),Object(c["createElementVNode"])("div",S,[Object(c["createElementVNode"])("span",{title:e.metricDocumentation},[Object(c["createElementVNode"])("strong",null,Object(c["toDisplayString"])(e.metricValue),1),Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])((e.metricTranslation||"").toLowerCase()),1)],8,k),null!==e.pastValue?(Object(c["openBlock"])(),Object(c["createElementBlock"])("span",{key:0,class:"metricEvolution",title:e.translate("General_EvolutionSummaryGeneric",e.metricValue,e.currentPeriod,e.pastValue,e.pastPeriod,e.metricChangePercent)},[Object(c["createElementVNode"])("span",{class:Object(c["normalizeClass"])({"positive-evolution":e.metricValueUnformatted>e.pastValueUnformatted,"negative-evolution":e.metricValueUnformatted<e.pastValueUnformatted})},Object(c["toDisplayString"])(e.metricChangePercent),3)],8,w)):Object(c["createCommentVNode"])("",!0)])],2)}function C(e,t){return _(e)||N(e,t)||P(e,t)||E()}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e,t){if(e){if("string"===typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function N(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(o=n.next()).done);a=!0)if(c.push(o.value),t&&c.length===t)break}catch(i){l=!0,r=i}finally{try{a||null==n["return"]||n["return"]()}finally{if(l)throw r}}return c}}function _(e){if(Array.isArray(e))return e}function x(){var e=p["Range"].getLastNRange(p["Matomo"].period,2,p["Matomo"].currentDateString),t=e.startDate,n=p["Periods"].get(p["Matomo"].period).parse(t).getDateRange();return"".concat(Object(p["format"])(n[0]),",").concat(Object(p["format"])(n[1]))}var D=window,A=D.$,B=Object(c["defineComponent"])({props:{metric:{type:String,required:!0},idGoal:[String,Number],metricTranslations:{type:Object,required:!0},metricDocumentations:Object,goals:{type:Object,required:!0},goalMetrics:Array},components:{Sparkline:p["Sparkline"]},setup:function(e){var t=Object(c["ref"])(null),n=Object(c["ref"])(!1),o=Object(c["ref"])(null),r=Object(c["ref"])(e.metric),a=Object(c["ref"])(e.idGoal),l=Object(c["computed"])((function(){return[a.value?"goal".concat(a.value,"_").concat(r.value):r.value]})),i=Object(c["computed"])((function(){var e;return null!==(e=o.value)&&void 0!==e&&e[1]?o.value[1][r.value]:null})),u=Object(c["computed"])((function(){var e;return null!==(e=o.value)&&void 0!==e&&e[2]?o.value[2][r.value]||0:null})),s=Object(c["computed"])((function(){if(!i.value)return null;var e="string"===typeof i.value?parseInt(i.value,10):i.value,t="string"===typeof u.value?parseInt(u.value,10):u.value,n=p["Matomo"].helper.calculateEvolution(e,t);return"".concat((100*n).toFixed(2)," %")})),m=Object(c["computed"])((function(){var e;if(null===(e=o.value)||void 0===e||!e[3])return null;var t=o.value[3];return t[r.value]||0})),d=Object(c["computed"])((function(){var e;if(null===(e=o.value)||void 0===e||!e[0])return null;var t=o.value[0];return t[r.value]||0})),f=Object(c["computed"])((function(){var t;return null!==(t=e.metricTranslations)&&void 0!==t&&t[r.value]?e.metricTranslations[r.value]:""})),b=Object(c["computed"])((function(){var t;return null!==(t=e.metricDocumentations)&&void 0!==t&&t[r.value]?e.metricDocumentations[r.value]:""})),v=Object(c["computed"])((function(){return p["Matomo"].startDateString===p["Matomo"].endDateString?p["Matomo"].endDateString:"".concat(p["Matomo"].startDateString,", ").concat(p["Matomo"].endDateString)}));function j(){return a.value||0===a.value}var O,g=Object(c["computed"])((function(){var e={module:"API",action:"get",columns:r.value};return j()&&(e.idGoal=a.value,e.module="Goals"),e})),y=Object(c["computed"])((function(){if("range"!==p["Matomo"].period)return x()})),S=Object(c["computed"])((function(){var t=[];return Object.keys(e.metricTranslations).forEach((function(n){t.push({column:n,translation:e.metricTranslations[n]})})),Object.values(e.goals||{}).forEach((function(n){e.goalMetrics.forEach((function(o){t.push({column:"goal".concat(n.idgoal,"_").concat(o),translation:"".concat(n.name," - ").concat(e.metricTranslations[o])})}))})),t}));function k(){var n=f.value;if(j()){var o,r=(null===(o=e.goals[a.value])||void 0===o?void 0:o.name)||Object(p["translate"])("General_Unknown");n="".concat(r," - ").concat(n)}A(t.value).closest("div.widget").find(".widgetTop > .widgetName > span").text(n)}function w(){var e=p["Range"].getLastNRange(p["Matomo"].period,2,p["Matomo"].currentDateString);return Object(p["format"])(e.startDate)}function V(){n.value=!0;var e=[],t="API",r="get",c={};j()&&(c.idGoal=a.value,c.filter_add_columns_when_show_all_columns=0,t="Goals",r="get");var l="".concat(t,".").concat(r);return e.push(p["AjaxHelper"].fetch(Object.assign({method:l,format_metrics:"all"},c))),"range"!==p["Matomo"].period&&(e.push(p["AjaxHelper"].fetch(Object.assign({method:l,format_metrics:"0"},c))),e.push(p["AjaxHelper"].fetch(Object.assign({method:l,date:w(),format_metrics:"0"},c))),e.push(p["AjaxHelper"].fetch(Object.assign({method:l,date:w(),format_metrics:"all"},c)))),Promise.all(e).then((function(e){o.value=e,n.value=!1}))}function E(e){r.value=e,V().then(k),A(t.value).closest("[widgetId]").trigger("setParameters",{column:r.value,idGoal:a.value})}function P(e){var t=void 0,n=e,o=e.match(/^goal([0-9]+)_(.*)/);if(o){t=+o[1];var c=C(o,3);n=c[2]}r.value===n&&t===a.value||(r.value=n,a.value=t,E(n))}function M(){var e=A(t.value),n=e.closest("div.widget").find(".widgetTop > .widgetName"),o=A('<div class="single-metric-view-picker"><div></div></div>'),r=Object(p["createVueApp"])({render:function(){return Object(c["createVNode"])(h,{multiselect:!1,selectableColumns:S.value,selectableRows:[],selectedColumns:l.value,selectedRows:[],onSelect:function(e){var t=e.columns;P(t[0])}})}});return n.append(o),r.mount(o.children()[0]),r}return Object(c["onMounted"])((function(){O=M()})),Object(c["onBeforeUnmount"])((function(){A(t.value).closest(".widgetContent").off("widget:destroy").off("widget:reload"),A(t.value).closest("div.widget").find(".single-metric-view-picker").remove(),O.unmount()})),Object(c["watch"])((function(){return e.metric}),(function(){E(e.metric)})),E(e.metric),{root:t,metricValue:d,isLoading:n,selectedColumns:l,responses:o,metricValueUnformatted:i,pastValueUnformatted:u,metricChangePercent:s,pastValue:m,metricTranslation:f,metricDocumentation:b,sparklineParams:g,pastPeriod:y,selectableColumns:S,currentPeriod:v}}});B.render=V;var T=B;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=CoreVisualizations.umd.min.js.map