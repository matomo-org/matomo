(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["ScheduledReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["ScheduledReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,r){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/ScheduledReports/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"8bbf":function(e,r){e.exports=t},a5a2:function(e,t){e.exports=r},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"ReportParameters",(function(){return d})),r.d(t,"ManageScheduledReport",(function(){return Je})),"undefined"!==typeof window){var o=window.document.currentScript,n=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(r.p=n[1])}var l=r("8bbf");
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */const i={key:0};function a(e,t,r,o,n,a){const c=Object(l["resolveComponent"])("Field");return e.report?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",i,[Object(l["createElementVNode"])("div",null,[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"checkbox",name:"report_email_me",introduction:e.translate("ScheduledReports_SendReportTo"),"model-value":e.report.emailMe,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("change","emailMe",t)),title:`${e.translate("ScheduledReports_SentToMe")} (${e.currentUserEmail})`},null,8,["introduction","model-value","title"]),[[l["vShow"],"email"===e.report.type]])]),Object(l["createElementVNode"])("div",null,[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"textarea","var-type":"array","model-value":e.report.additionalEmails,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("change","additionalEmails",t)),title:e.translate("ScheduledReports_AlsoSendReportToTheseEmails")},null,8,["model-value","title"]),[[l["vShow"],"email"===e.report.type]])])])):Object(l["createCommentVNode"])("",!0)}var c=r("a5a2"),p=Object(l["defineComponent"])({props:{report:{type:Object,required:!0},reportType:{type:String,required:!0},defaultDisplayFormat:{type:Number,required:!0},defaultEmailMe:{type:Boolean,required:!0},defaultEvolutionGraph:{type:Boolean,required:!0},currentUserEmail:{type:String,required:!0}},emits:["change"],components:{Field:c["Field"]},setup(e){const{resetReportParametersFunctions:t,updateReportParametersFunctions:r,getReportParametersFunctions:o}=window;t[e.reportType]||(t[e.reportType]=t=>{t.displayFormat=e.defaultDisplayFormat,t.emailMe=e.defaultEmailMe,t.evolutionGraph=e.defaultEvolutionGraph,t.additionalEmails=[]}),r[e.reportType]||(r[e.reportType]=e=>{null!==e&&void 0!==e&&e.parameters&&["displayFormat","emailMe","evolutionGraph","additionalEmails"].forEach(t=>{t in e.parameters&&(e[t]=e.parameters[t])})}),o[e.reportType]||(o[e.reportType]=e=>({displayFormat:e.displayFormat,emailMe:e.emailMe,evolutionGraph:e.evolutionGraph,additionalEmails:e.additionalEmails||[]}))}});p.render=a;var d=p;const s={class:"emailReports",ref:"root"},u={ref:"reportSentSuccess"},m={ref:"reportUpdatedSuccess"},b=Object(l["createElementVNode"])("div",{id:"ajaxError",style:{display:"none"}},null,-1),O={id:"ajaxLoadingDiv",style:{display:"none"}},y={class:"loadingPiwik"},j=["alt"],h={class:"loadingSegment"},g=Object(l["createElementVNode"])("a",{id:"bottom"},null,-1);function v(e,t,r,o,n,i){const a=Object(l["resolveComponent"])("ListReports"),c=Object(l["resolveComponent"])("AddReport");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",s,[Object(l["createElementVNode"])("div",u,null,512),Object(l["createElementVNode"])("div",m,null,512),Object(l["createElementVNode"])("div",null,[b,Object(l["createElementVNode"])("div",O,[Object(l["createElementVNode"])("div",y,[Object(l["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif",alt:e.translate("General_LoadingData")},null,8,j),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_LoadingData")),1)]),Object(l["createElementVNode"])("div",h,Object(l["toDisplayString"])(e.translate("SegmentEditor_LoadingSegmentedDataMayTakeSomeTime")),1)]),Object(l["withDirectives"])(Object(l["createVNode"])(a,{"content-title":e.contentTitle,"user-login":e.userLogin,"login-module":e.loginModule,reports:e.reports,"site-name":e.decodedSiteName,"segment-editor-activated":e.segmentEditorActivated,"saved-segments-by-id":e.savedSegmentsById,periods:e.periods,"report-types":e.reportTypes,"download-output-type":e.downloadOutputType,language:e.language,"report-formats-by-report-type":e.reportFormatsByReportType,onCreate:t[0]||(t[0]=t=>e.createReport()),onEdit:t[1]||(t[1]=t=>e.editReport(t)),onDelete:t[2]||(t[2]=t=>e.deleteReport(t)),onSendnow:t[3]||(t[3]=t=>e.sendReportNow(t))},null,8,["content-title","user-login","login-module","reports","site-name","segment-editor-activated","saved-segments-by-id","periods","report-types","download-output-type","language","report-formats-by-report-type"]),[[l["vShow"],e.showReportsList]]),e.showReportForm?(Object(l["openBlock"])(),Object(l["createBlock"])(c,{key:0,report:e.report,periods:e.periods,"param-periods":e.paramPeriods,"report-type-options":e.reportTypeOptions,"report-formats-by-report-type-options":e.reportFormatsByReportTypeOptions,"display-formats":e.displayFormats,"reports-by-category-by-report-type":e.reportsByCategoryByReportType,"allow-multiple-reports-by-report-type":e.allowMultipleReportsByReportType,"count-websites":e.countWebsites,"site-name":e.decodedSiteName,"selected-reports":e.selectedReports,"report-types":e.reportTypes,"segment-editor-activated":e.segmentEditorActivated,"saved-segments-by-id":e.savedSegmentsById,onToggleSelectedReport:t[4]||(t[4]=t=>e.toggleSelectedReport(t.reportType,t.uniqueId)),onChange:t[5]||(t[5]=t=>e.onChangeProperty(t.prop,t.value)),onSubmit:t[6]||(t[6]=t=>e.submitReport())},{"report-parameters":Object(l["withCtx"])(()=>[Object(l["renderSlot"])(e.$slots,"report-parameters")]),_:3},8,["report","periods","param-periods","report-type-options","report-formats-by-report-type-options","display-formats","reports-by-category-by-report-type","allow-multiple-reports-by-report-type","count-websites","site-name","selected-reports","report-types","segment-editor-activated","saved-segments-by-id"])):Object(l["createCommentVNode"])("",!0),g])],512)}var f=r("19dc");const R=Object(l["createElementVNode"])("div",{class:"clear"},null,-1),S={key:0},E=["innerHTML"],N={id:"emailScheduleInlineHelp",class:"inline-help-node"},V=Object(l["createElementVNode"])("br",null,null,-1),k={id:"emailReportPeriodInlineHelp",class:"inline-help-node"},w=Object(l["createElementVNode"])("br",null,null,-1),B=Object(l["createElementVNode"])("br",null,null,-1),_={key:0,id:"reportHourHelpText",class:"inline-help-node"},T=["textContent"],C={ref:"reportParameters"},P={class:"email"},F={class:"report_evolution_graph"},D={class:"row evolution-graph-period"},x={class:"col s12"},q={for:"report_evolution_period_for_each"},M=["checked"],I=["innerHTML"],L={class:"col s12"},H={for:"report_evolution_period_for_prev"},A=["checked"],G=["value"],U={class:"row"},z={class:"col s12"},W={class:"reportCategory"},Z={class:"listReports"},K=["name","type","id","checked","onChange"],X={key:0,class:"entityInlineHelp"},J=Object(l["createElementVNode"])("br",null,null,-1),Q=["innerHTML"];function Y(e,t,r,o,n,i){const a=Object(l["resolveComponent"])("Field"),c=Object(l["resolveComponent"])("SaveButton"),p=Object(l["resolveComponent"])("ContentBlock"),d=Object(l["resolveDirective"])("form");return Object(l["openBlock"])(),Object(l["createBlock"])(p,{class:"entityAddContainer","content-title":e.contentTitle},{default:Object(l["withCtx"])(()=>[R,Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("form",{id:"addEditReport",onSubmit:t[13]||(t[13]=t=>e.$emit("submit"))},[Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"text",name:"website",title:e.translate("General_Website"),disabled:!0,"model-value":e.siteName},null,8,["title","model-value"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"textarea",name:"report_description",title:e.translate("General_Description"),"model-value":e.report.description,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("change",{prop:"description",value:t})),"inline-help":e.translate("ScheduledReports_DescriptionOnFirstPage")},null,8,["title","model-value","inline-help"])]),e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",S,[Object(l["createVNode"])(a,{uicontrol:"select",name:"report_segment",title:e.translate("SegmentEditor_ChooseASegment"),"model-value":e.report.idsegment,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("change",{prop:"idsegment",value:t})),options:e.savedSegmentsById},{"inline-help":Object(l["withCtx"])(()=>[e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:0,id:"reportSegmentInlineHelp",class:"inline-help-node",innerHTML:e.$sanitize(e.reportSegmentInlineHelp)},null,8,E)):Object(l["createCommentVNode"])("",!0)]),_:1},8,["title","model-value","options"])])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"select",name:"report_schedule","model-value":e.report.period,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.$emit("change",{prop:"period",value:t}),e.$emit("change",{prop:"periodParam",value:"never"===e.report.period?null:e.report.period})}),title:e.translate("ScheduledReports_EmailSchedule"),options:e.periods},{"inline-help":Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",N,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_WeeklyScheduleHelp"))+" ",1),V,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MonthlyScheduleHelp")),1)])]),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"select",name:"report_period","model-value":e.report.periodParam,"onUpdate:modelValue":t[3]||(t[3]=t=>e.$emit("change",{prop:"periodParam",value:t})),options:e.paramPeriods,title:e.translate("ScheduledReports_ReportPeriod")},{"inline-help":Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",k,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportPeriodHelp"))+" ",1),w,B,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportPeriodHelp2")),1)])]),_:1},8,["model-value","options","title"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"select",name:"report_hour","model-value":e.report.hour,"onUpdate:modelValue":t[4]||(t[4]=t=>e.$emit("change",{prop:"hour",value:t})),title:e.translate("ScheduledReports_ReportHour","X"),options:e.reportHours},{"inline-help":Object(l["withCtx"])(()=>[0!==e.timezoneOffset&&"0"!==e.timezoneOffset?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",_,[Object(l["createElementVNode"])("span",{textContent:Object(l["toDisplayString"])(e.reportHourUtc)},null,8,T)])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(a,{uicontrol:"select",name:"report_type",disabled:1===e.reportTypes.length,"model-value":e.report.type,"onUpdate:modelValue":t[5]||(t[5]=t=>e.$emit("change",{prop:"type",value:t})),title:e.translate("ScheduledReports_ReportType"),options:e.reportTypeOptions},null,8,["disabled","model-value","title","options"])]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportFormatsByReportTypeOptions,(t,r)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:r},[Object(l["withDirectives"])(Object(l["createVNode"])(a,{uicontrol:"select",name:"report_format",title:e.translate("ScheduledReports_ReportFormat"),class:Object(l["normalizeClass"])(r),"model-value":e.report["format"+r],"onUpdate:modelValue":t=>e.$emit("change",{prop:"format"+r,value:t}),options:t},null,8,["title","class","model-value","onUpdate:modelValue","options"]),[[l["vShow"],e.report.type===r]])]))),128)),Object(l["createElementVNode"])("div",C,[Object(l["renderSlot"])(e.$slots,"report-parameters")],512),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("div",P,[Object(l["createVNode"])(a,{uicontrol:"select",name:"display_format","model-value":e.report.displayFormat,"onUpdate:modelValue":t[6]||(t[6]=t=>e.$emit("change",{prop:"displayFormat",value:t})),options:e.displayFormats,introduction:e.translate("ScheduledReports_AggregateReportsFormat")},null,8,["model-value","options","introduction"])]),Object(l["createElementVNode"])("div",F,[Object(l["withDirectives"])(Object(l["createVNode"])(a,{uicontrol:"checkbox",name:"report_evolution_graph",title:e.translate("ScheduledReports_EvolutionGraph",5),"model-value":e.report.evolutionGraph,"onUpdate:modelValue":t[7]||(t[7]=t=>e.$emit("change",{prop:"evolutionGraph",value:t}))},null,8,["title","model-value"]),[[l["vShow"],-1!==[2,"2",3,"3"].indexOf(e.report.displayFormat)]])]),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",D,[Object(l["createElementVNode"])("div",x,[Object(l["createElementVNode"])("label",q,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_each",name:"report_evolution_period_for",type:"radio",value:"each",checked:"each"===e.report.evolutionPeriodFor,onChange:t[8]||(t[8]=t=>e.$emit("change",{prop:"evolutionPeriodFor",value:t.target.value}))},null,40,M),Object(l["createElementVNode"])("span",{innerHTML:e.$sanitize(e.evolutionGraphsShowForEachInPeriod)},null,8,I)])]),Object(l["createElementVNode"])("div",L,[Object(l["createElementVNode"])("label",H,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_prev",name:"report_evolution_period_for",type:"radio",value:"prev",checked:"prev"===e.report.evolutionPeriodFor,onChange:t[9]||(t[9]=t=>e.$emit("change",{prop:"evolutionPeriodFor",value:t.target.value}))},null,40,A),Object(l["createElementVNode"])("span",null,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_EvolutionGraphsShowForPreviousN",e.frequencyPeriodPlural))+": ",1),Object(l["createElementVNode"])("input",{type:"number",name:"report_evolution_period_n",value:e.report.evolutionPeriodN,onKeydown:t[10]||(t[10]=t=>e.onEvolutionPeriodN(t)),onChange:t[11]||(t[11]=t=>e.onEvolutionPeriodN(t))},null,40,G)])])])],512),[[l["vShow"],-1!==[1,"1",2,"2",3,"3"].indexOf(e.report.displayFormat)]])],512),[[l["vShow"],"email"===e.report.type&&"csv"!==e.report.formatemail&&"tsv"!==e.report.formatemail]]),Object(l["createElementVNode"])("div",U,[Object(l["createElementVNode"])("h3",z,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportsIncluded")),1)]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportsByCategoryByReportTypeInColumns,(t,r)=>Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{name:"reportsList",class:Object(l["normalizeClass"])("row "+r),key:r},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"col s12 m6",key:o},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:o},[Object(l["createElementVNode"])("h3",W,Object(l["toDisplayString"])(o),1),Object(l["createElementVNode"])("ul",Z,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,t=>{var o;return Object(l["openBlock"])(),Object(l["createElementBlock"])("li",{key:t.uniqueId},[Object(l["createElementVNode"])("label",null,[Object(l["createElementVNode"])("input",{name:r+"Reports",type:e.allowMultipleReportsByReportType[r]?"checkbox":"radio",id:`${r}${t.uniqueId}`,checked:null===(o=e.selectedReports[r])||void 0===o?void 0:o[t.uniqueId],onChange:o=>e.$emit("toggleSelectedReport",{reportType:r,uniqueId:t.uniqueId})},null,40,K),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e.decode(t.name)),1),"MultiSites_getAll"===t.uniqueId?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",X,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportIncludeNWebsites",e.countWebsites)),1)):Object(l["createCommentVNode"])("",!0)])])}),128))]),J]))),128))]))),128))],2)),[[l["vShow"],e.report.type===r]])),128)),Object(l["createVNode"])(c,{value:e.saveButtonTitle,onConfirm:t[12]||(t[12]=t=>e.$emit("submit"))},null,8,["value"]),Object(l["createElementVNode"])("div",{class:"entityCancel",innerHTML:e.$sanitize(e.entityCancelText)},null,8,Q)],32)),[[d]])]),_:3},8,["content-title"])}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function ee(e,t){return""+(24+parseFloat(e)+t)%24}const{$:te}=window;var re=Object(l["defineComponent"])({props:{report:{type:Object,required:!0},selectedReports:Object,paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0},siteName:{type:String,required:!0},reportTypes:{type:Object,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0}},emits:["submit","change","toggleSelectedReport"],components:{ContentBlock:f["ContentBlock"],Field:c["Field"],SaveButton:c["SaveButton"]},directives:{Form:c["Form"]},created(){this.onEvolutionPeriodN=Object(f["debounce"])(this.onEvolutionPeriodN,50)},methods:{onEvolutionPeriodN(e){this.$emit("change",{prop:"evolutionPeriodN",value:e.target.value})},decode(e){return f["Matomo"].helper.htmlDecode(e)}},setup(e,t){const r=Object(l["ref"])(null);return Object(l["watch"])(()=>e.report,e=>{const t=r.value;t.querySelectorAll("[vue-entry]").forEach(t=>{te(t).data("vueAppInstance").report_=e})}),Object(l["onMounted"])(()=>{const o=r.value;f["Matomo"].helper.compileVueEntryComponents(o,{report:e.report,onChange(e,r){t.emit("change",{prop:e,value:r})}})}),{reportParameters:r}},beforeUnmount(){const e=this.$refs.reportParameters;f["Matomo"].helper.destroyVueComponent(e)},computed:{reportsByCategoryByReportTypeInColumns(){const e=this.reportsByCategoryByReportType,t=Object.entries(e).map(([e,t])=>{const r=Math.floor((Object.keys(t).length+1)/2),o={},n={};let l=o;return Object.entries(t).forEach(([e,t])=>{l[e]=t,Object.keys(l).length>=r&&(l=n)}),[e,[o,n]]});return Object.fromEntries(t)},entityCancelText(){return Object(f["translate"])("General_OrCancel",'<a class="entityCancelLink">',"</a>")},frequencyPeriodSingle(){if(!this.report||!this.report.period)return"";const{ReportPlugin:e}=window;let t=e.periodTranslations[this.report.period];return t||(t=e.periodTranslations.day),t.single},frequencyPeriodPlural(){if(!this.report||!this.report.period)return"";const{ReportPlugin:e}=window;let t=e.periodTranslations[this.report.period];return t||(t=e.periodTranslations.day),t.plural},evolutionGraphsShowForEachInPeriod(){return Object(f["translate"])("ScheduledReports_EvolutionGraphsShowForEachInPeriod","<strong>","</strong>",this.frequencyPeriodSingle)},reportSegmentInlineHelp(){return Object(f["translate"])("ScheduledReports_Segment_Help",'<a href="./" rel="noreferrer noopener" target="_blank">',"</a>",Object(f["translate"])("SegmentEditor_DefaultAllVisits"),Object(f["translate"])("SegmentEditor_AddNewSegment"))},timezoneOffset(){return f["Matomo"].timezoneOffset},timeZoneDifferenceInHours(){return f["Matomo"].timezoneOffset/3600},reportHours(){const e=[];for(let t=0;t<24;t+=1)2*this.timeZoneDifferenceInHours%2!==0?e.push({key:t+".5",value:t+":30"}):e.push({key:""+t,value:""+t});return e},reportHourUtc(){const e=ee(this.report.hour,-this.timeZoneDifferenceInHours);return Object(f["translate"])("ScheduledReports_ReportHourWithUTC",[e])},saveButtonTitle(){const{ReportPlugin:e}=window,t=this.report.idreport>0;return t?e.updateReportString:e.createReportString},contentTitle(){const{ReportPlugin:e}=window,t=this.report.idreport>0;return t?e.updateReportString:Object(f["translate"])("ScheduledReports_CreateAndScheduleReport")}}});re.render=Y;var oe=re;const ne={class:"first"},le={key:0},ie={colspan:"7"},ae=Object(l["createElementVNode"])("br",null,null,-1),ce=Object(l["createElementVNode"])("br",null,null,-1),pe=["href"],de=Object(l["createElementVNode"])("br",null,null,-1),se=Object(l["createElementVNode"])("br",null,null,-1),ue={key:1},me={colspan:"7"},be=Object(l["createElementVNode"])("br",null,null,-1),Oe=Object(l["createElementVNode"])("br",null,null,-1),ye=Object(l["createElementVNode"])("br",null,null,-1),je={class:"first"},he={key:0,class:"entityInlineHelp",style:{"font-size":"9pt"}},ge={key:0},ve={key:1},fe={key:0},Re={key:0},Se=Object(l["createElementVNode"])("br",null,null,-1),Ee=["onClick"],Ne=["src"],Ve=["id","action"],ke=["value"],we=Object(l["createElementVNode"])("input",{type:"hidden",name:"force_api_session",value:"1"},null,-1),Be=["onClick","id"],_e=["src"],Te={style:{"text-align":"center","padding-top":"2px"}},Ce=["onClick","title"],Pe=Object(l["createElementVNode"])("span",{class:"icon-edit"},null,-1),Fe=[Pe],De={style:{"text-align":"center","padding-top":"2px"}},xe=["onClick","title"],qe=Object(l["createElementVNode"])("span",{class:"icon-delete"},null,-1),Me=[qe],Ie={class:"tableActionBar"},$e=Object(l["createElementVNode"])("span",{class:"icon-add"},null,-1);function Le(e,t,r,o,n,i){const a=Object(l["resolveComponent"])("ContentBlock"),c=Object(l["resolveDirective"])("content-table");return Object(l["openBlock"])(),Object(l["createBlock"])(a,{id:"entityEditContainer",class:"entityTableContainer","help-url":e.externalRawLink("https://matomo.org/docs/email-reports/"),feature:"true","content-title":e.contentTitle},{default:Object(l["withCtx"])(()=>{var r;return[Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("table",null,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",ne,Object(l["toDisplayString"])(e.translate("General_Description")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_EmailSchedule")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportFormat")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportTo")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Download")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Edit")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Delete")),1)])]),Object(l["createElementVNode"])("tbody",null,["anonymous"===e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",le,[Object(l["createElementVNode"])("td",ie,[ae,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MustBeLoggedIn"))+" ",1),ce,Object(l["createTextVNode"])("› "),Object(l["createElementVNode"])("a",{href:"index.php?module="+e.loginModule},Object(l["toDisplayString"])(e.translate("Login_LogIn")),9,pe),de,se])])):null!==(r=e.reports)&&void 0!==r&&r.length?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",ue,[Object(l["createElementVNode"])("td",me,[be,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ThereIsNoReportToManage",e.siteName))+". ",1),Oe,ye])])),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.decodedReports,t=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:t.idreport},[Object(l["createElementVNode"])("td",je,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(t.description)+" ",1),e.segmentEditorActivated&&t.idsegment?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",he,[e.savedSegmentsById[t.idsegment]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",ge,Object(l["toDisplayString"])(e.savedSegmentsById[t.idsegment]),1)):(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",ve,Object(l["toDisplayString"])(e.translate("ScheduledReports_SegmentDeleted")),1))])):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.periods[t.period])+" ",1),Object(l["createElementVNode"])("td",null,[t.format?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",fe,Object(l["toDisplayString"])(t.format.toUpperCase()),1)):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,[0===t.recipients.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Re,Object(l["toDisplayString"])(e.translate("ScheduledReports_NoRecipients")),1)):Object(l["createCommentVNode"])("",!0),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t.recipients,(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",{key:t},[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e)+" ",1),Se]))),128)),0!==t.recipients.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("a",{key:1,href:"#",name:"linkSendNow",class:"link_but withIcon",style:{"margin-top":"3px"},onClick:Object(l["withModifiers"])(r=>e.$emit("sendnow",t.idreport),["prevent"])},[Object(l["createElementVNode"])("img",{border:"0",src:e.reportTypes[t.type]},null,8,Ne),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportNow")),1)],8,Ee)):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("form",{method:"POST",target:"_blank",id:"downloadReportForm_"+t.idreport,action:e.linkTo({module:"API",segment:null,method:"ScheduledReports.generateReport",idReport:t.idreport,outputType:e.downloadOutputType,language:e.language,format:-1!==["html","csv","tsv"].indexOf(t.format)?t.format:"original"})},[Object(l["createElementVNode"])("input",{type:"hidden",name:"token_auth",value:e.token_auth},null,8,ke),we],8,Ve),Object(l["createElementVNode"])("a",{href:"",rel:"noreferrer noopener",name:"linkDownloadReport",class:"link_but withIcon",onClick:Object(l["withModifiers"])(r=>e.displayReport(t.idreport),["prevent"]),id:t.idreport},[Object(l["createElementVNode"])("img",{border:"0",width:16,height:16,src:e.reportFormatsByReportType[t.type][t.format]},null,8,_e),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_Download")),1)],8,Be)]),Object(l["createElementVNode"])("td",Te,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:r=>e.$emit("edit",t.idreport),title:e.translate("General_Edit")},Fe,8,Ce)]),Object(l["createElementVNode"])("td",De,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:r=>e.$emit("delete",t.idreport),title:e.translate("General_Delete")},Me,8,xe)])]))),128))])])),[[c]]),Object(l["createElementVNode"])("div",Ie,["anonymous"!==e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("button",{key:0,id:"add-report",onClick:t[0]||(t[0]=t=>e.$emit("create"))},[$e,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_CreateAndScheduleReport")),1)])):Object(l["createCommentVNode"])("",!0)])]}),_:1},8,["help-url","content-title"])}function He(){return He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},He.apply(this,arguments)}var Ae=Object(l["defineComponent"])({props:{contentTitle:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:Number,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0},reportTypes:{type:Object,required:!0}},components:{ContentBlock:f["ContentBlock"]},directives:{ContentTable:f["ContentTable"]},emits:["create","edit","delete","sendnow"],methods:{linkTo(e){return"?"+f["MatomoUrl"].stringify(He(He({},f["MatomoUrl"].urlParsed.value),e))},displayReport(e){$("#downloadReportForm_"+e).submit()}},computed:{token_auth(){return f["Matomo"].token_auth},decodedReports(){return this.reports.map(e=>He(He({},e),{},{description:f["Matomo"].helper.htmlDecode(e.description)}))}}});Ae.render=Le;var Ge=Ae;function Ue(){f["Matomo"].helper.lazyScrollTo(".emailReports",200)}function ze(e,t){var r;null!==(r=window.updateReportParametersFunctions)&&void 0!==r&&r[e]&&window.updateReportParametersFunctions[e](t)}function We(e,t){var r;null!==(r=window.resetReportParametersFunctions)&&void 0!==r&&r[e]&&window.resetReportParametersFunctions[e](t)}window.resetReportParametersFunctions=window.resetReportParametersFunctions||{},window.updateReportParametersFunctions=window.updateReportParametersFunctions||{},window.getReportParametersFunctions=window.getReportParametersFunctions||{};const{$:Ze}=window,Ke=f["Matomo"].timezoneOffset/3600;var Xe=Object(l["defineComponent"])({props:{contentTitle:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:Number,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0},paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0},reportTypes:{type:Object,required:!0}},components:{AddReport:oe,ListReports:Ge},directives:{ContentTable:f["ContentTable"],Form:c["Form"]},mounted(){Ze(this.$refs.root).on("click","a.entityCancelLink",()=>{this.showListOfReports()}),f["Matomo"].postEvent("ScheduledReports.ManageScheduledReport.mounted",{element:this.$refs.root})},unmounted(){f["Matomo"].postEvent("ScheduledReports.ManageScheduledReport.unmounted",{element:this.$refs.root})},data(){return{showReportsList:!0,report:{},selectedReports:{}}},methods:{sendReportNow(e){Ue(),f["AjaxHelper"].post({method:"ScheduledReports.sendReport"},{idReport:e,force:!0}).then(()=>{this.fadeInOutSuccessMessage(this.$refs.reportSentSuccess,Object(f["translate"])("ScheduledReports_ReportSent"),!1)})},formSetEditReport(e){const{ReportPlugin:t}=window;let r={idreport:e,type:t.defaultReportType,format:t.defaultReportFormat,description:"",period:t.defaultPeriod,hour:t.defaultHour,reports:[],idsegment:"",evolutionPeriodFor:"prev",evolutionPeriodN:t.defaultEvolutionPeriodN,periodParam:t.defaultPeriod};e>0?(r=t.reportList[e],ze(r.type,r)):We(r.type,r),r.hour=ee(r.hour,Ke),this.selectedReports={},Object.values(r.reports).forEach(e=>{this.selectedReports[r.type]=this.selectedReports[r.type]||{},this.selectedReports[r.type][e]=!0}),r["format"+r.type]=r.format,r.idsegment||(r.idsegment=""),this.report=r,this.report.description=f["Matomo"].helper.htmlDecode(r.description)},fadeInOutSuccessMessage(e,t,r=!0){f["NotificationsStore"].show({message:t,placeat:e,context:"success",noclear:!0,type:"toast",style:{display:"inline-block",marginTop:"10px"},id:"scheduledReportSuccess"}),r&&f["Matomo"].helper.refreshAfter(2)},changedReportType(){We(this.report.type,this.report)},deleteReport(e){f["Matomo"].helper.modalConfirm("#confirm",{yes:()=>{f["AjaxHelper"].post({method:"ScheduledReports.deleteReport"},{idReport:e},{redirectOnSuccess:!0})}})},showListOfReports(e){this.showReportsList=!0,f["Matomo"].helper.hideAjaxError(),("undefined"===typeof e||e)&&Ue()},createReport(){this.showReportsList=!1,Object(l["nextTick"])(()=>{this.formSetEditReport(0)})},editReport(e){this.showReportsList=!1,Object(l["nextTick"])(()=>{this.formSetEditReport(e)})},submitReport(){const e={idReport:this.report.idreport,description:this.report.description,idSegment:this.report.idsegment,reportType:this.report.type,reportFormat:this.report["format"+this.report.type],periodParam:this.report.periodParam,evolutionPeriodFor:this.report.evolutionPeriodFor};"each"!==e.evolutionPeriodFor&&(e.evolutionPeriodN=this.report.evolutionPeriodN);const{period:t}=this.report,r=ee(this.report.hour,-Ke),o=this.selectedReports[e.reportType]||{},n=Object.keys(o).filter(t=>this.selectedReports[e.reportType][t]);n.length>0&&(e.reports=n);const l=window.getReportParametersFunctions[this.report.type](this.report);e.parameters=l;const i=this.report.idreport>0;return f["AjaxHelper"].post({method:i?"ScheduledReports.updateReport":"ScheduledReports.addReport",period:t,hour:r},e).then(()=>{this.fadeInOutSuccessMessage(this.$refs.reportUpdatedSuccess,Object(f["translate"])("ScheduledReports_ReportUpdated"))}),!1},onChangeProperty(e,t){this.report[e]=t,"type"===e&&this.changedReportType()},toggleSelectedReport(e,t){this.selectedReports[e]=this.selectedReports[e]||{},this.selectedReports[e][t]=!this.selectedReports[e][t]}},computed:{showReportForm(){return!this.showReportsList},decodedSiteName(){return f["Matomo"].helper.htmlDecode(this.siteName)}}});Xe.render=v;var Je=Xe;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=ScheduledReports.umd.min.js.map